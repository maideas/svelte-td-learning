var app=function(t){"use strict";function e(){}function n(t,e){for(const n in e)t[n]=e[n];return t}function a(t){return t()}function r(){return Object.create(null)}function l(t){t.forEach(a)}function s(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function o(t){const e={};for(const n in t)"$"!==n[0]&&(e[n]=t[n]);return e}function u(t){return null==t?"":t}function c(t,e){t.appendChild(e)}function d(t,e,n){t.insertBefore(e,n||null)}function f(t){t.parentNode.removeChild(t)}function g(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function p(t){return document.createElement(t)}function m(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function h(t){return document.createTextNode(t)}function $(){return h(" ")}function y(t,e,n,a){return t.addEventListener(e,n,a),()=>t.removeEventListener(e,n,a)}function x(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function v(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function w(t,e,n,a){t.style.setProperty(e,n,a?"important":"")}function b(t,e){for(let n=0;n<t.options.length;n+=1){const a=t.options[n];if(a.__value===e)return void(a.selected=!0)}}function k(t,e,n){t.classList[n?"add":"remove"](e)}let S;function A(t){S=t}function Q(t){(function(){if(!S)throw new Error("Function called outside component initialization");return S})().$$.on_mount.push(t)}const E=[],R=[],V=[],N=[],T=Promise.resolve();let z=!1;function B(t){V.push(t)}function _(t){N.push(t)}let M=!1;const I=new Set;function P(){if(!M){M=!0;do{for(let t=0;t<E.length;t+=1){const e=E[t];A(e),Y(e.$$)}for(A(null),E.length=0;R.length;)R.pop()();for(let t=0;t<V.length;t+=1){const e=V[t];I.has(e)||(I.add(e),e())}V.length=0}while(E.length);for(;N.length;)N.pop()();z=!1,M=!1,I.clear()}}function Y(t){if(null!==t.fragment){t.update(),l(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(B)}}const j=new Set;let L;function X(){L={r:0,c:[],p:L}}function F(){L.r||l(L.c),L=L.p}function D(t,e){t&&t.i&&(j.delete(t),t.i(e))}function O(t,e,n,a){if(t&&t.o){if(j.has(t))return;j.add(t),L.c.push((()=>{j.delete(t),a&&(n&&t.d(1),a())})),t.o(e)}}function C(t,e,n){const a=t.$$.props[e];void 0!==a&&(t.$$.bound[a]=n,n(t.$$.ctx[a]))}function G(t){t&&t.c()}function q(t,e,n){const{fragment:r,on_mount:i,on_destroy:o,after_update:u}=t.$$;r&&r.m(e,n),B((()=>{const e=i.map(a).filter(s);o?o.push(...e):l(e),t.$$.on_mount=[]})),u.forEach(B)}function H(t,e){const n=t.$$;null!==n.fragment&&(l(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function J(t,e){-1===t.$$.dirty[0]&&(E.push(t),z||(z=!0,T.then(P)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function K(t,n,a,s,i,o,u=[-1]){const c=S;A(t);const d=n.props||{},g=t.$$={fragment:null,ctx:null,props:o,update:e,not_equal:i,bound:r(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(c?c.$$.context:[]),callbacks:r(),dirty:u,skip_bound:!1};let p=!1;if(g.ctx=a?a(t,d,((e,n,...a)=>{const r=a.length?a[0]:n;return g.ctx&&i(g.ctx[e],g.ctx[e]=r)&&(!g.skip_bound&&g.bound[e]&&g.bound[e](r),p&&J(t,e)),n})):[],g.update(),p=!0,l(g.before_update),g.fragment=!!s&&s(g.ctx),n.target){if(n.hydrate){const t=function(t){return Array.from(t.childNodes)}(n.target);g.fragment&&g.fragment.l(t),t.forEach(f)}else g.fragment&&g.fragment.c();n.intro&&D(t.$$.fragment),q(t,n.target,n.anchor),P()}A(c)}class U{$destroy(){H(this,1),this.$destroy=e}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function W(t){let n,a,r;return{c(){n=m("svg"),a=m("path"),x(a,"fill","currentColor"),x(a,"d",t[0]),x(n,"aria-hidden","true"),x(n,"class",r=u(t[1])+" svelte-1d15yci"),x(n,"role","img"),x(n,"xmlns","http://www.w3.org/2000/svg"),x(n,"viewBox",t[2])},m(t,e){d(t,n,e),c(n,a)},p(t,[e]){1&e&&x(a,"d",t[0]),2&e&&r!==(r=u(t[1])+" svelte-1d15yci")&&x(n,"class",r),4&e&&x(n,"viewBox",t[2])},i:e,o:e,d(t){t&&f(n)}}}function Z(t,e,a){let{icon:r}=e,l=[],s="",i="";return t.$$set=t=>{a(4,e=n(n({},e),o(t))),"icon"in t&&a(3,r=t.icon)},t.$$.update=()=>{8&t.$$.dirty&&a(2,i="0 0 "+r.icon[0]+" "+r.icon[1]),a(1,s="fa-svelte "+(e.class?e.class:"")),8&t.$$.dirty&&a(0,l=r.icon[4])},e=o(e),[l,s,i,r]}class tt extends U{constructor(t){super(),K(this,t,Z,W,i,{icon:3})}}
/*!
     * Font Awesome Free 5.15.1 by @fontawesome - https://fontawesome.com
     * License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)
     */var et={prefix:"far",iconName:"arrow-alt-circle-up",icon:[512,512,[],"f35b","M256 504c137 0 248-111 248-248S393 8 256 8 8 119 8 256s111 248 248 248zm0-448c110.5 0 200 89.5 200 200s-89.5 200-200 200S56 366.5 56 256 145.5 56 256 56zm20 328h-40c-6.6 0-12-5.4-12-12V256h-67c-10.7 0-16-12.9-8.5-20.5l99-99c4.7-4.7 12.3-4.7 17 0l99 99c7.6 7.6 2.2 20.5-8.5 20.5h-67v116c0 6.6-5.4 12-12 12z"]};function nt(t){let e,n,a=t[2].toFixed()+"";return{c(){e=p("span"),n=h(a),x(e,"class","svelte-6n71zn")},m(t,a){d(t,e,a),c(e,n)},p(t,e){4&e&&a!==(a=t[2].toFixed()+"")&&v(n,a)},d(t){t&&f(e)}}}function at(t){let e,n,a=t[2].toFixed(1)+"";return{c(){e=p("span"),n=h(a),x(e,"class","svelte-6n71zn")},m(t,a){d(t,e,a),c(e,n)},p(t,e){4&e&&a!==(a=t[2].toFixed(1)+"")&&v(n,a)},d(t){t&&f(e)}}}function rt(t){let e,n,a;return n=new tt({props:{icon:et}}),{c(){e=p("div"),G(n.$$.fragment),w(e,"font-size","32px"),w(e,"transform","rotate("+t[4]+"deg)"),x(e,"class","svelte-6n71zn")},m(t,r){d(t,e,r),q(n,e,null),a=!0},p(t,n){(!a||16&n)&&w(e,"transform","rotate("+t[4]+"deg)")},i(t){a||(D(n.$$.fragment,t),a=!0)},o(t){O(n.$$.fragment,t),a=!1},d(t){t&&f(e),H(n)}}}function lt(t){let n;return{c(){n=h("terminal state")},m(t,e){d(t,n,e)},p:e,i:e,o:e,d(t){t&&f(n)}}}function st(t){let n;return{c(){n=h("blocked")},m(t,e){d(t,n,e)},p:e,i:e,o:e,d(t){t&&f(n)}}}function it(t){let e,n,a,r,l,s,i,o,u,g,m,y,w,b,S,A,Q,E,R,V,N,T,z,B,_,M,I,P,Y,j,L=t[3][ot.up].toFixed(3)+"",C=t[3][ot.left].toFixed(3)+"",G=t[3][ot.right].toFixed(3)+"",q=t[3][ot.down].toFixed(3)+"";function H(t,e){return(null==u||4&e)&&(u=!!(Math.abs(t[2])<10)),u?at:nt}let J=H(t,-1),K=J(t);const U=[st,lt,rt],W=[];function Z(t,e){return t[0]?0:t[1]?1:2}return A=Z(t),Q=W[A]=U[A](t),{c(){e=p("div"),n=p("div"),a=$(),r=p("div"),l=p("span"),s=h(L),i=$(),o=p("div"),K.c(),g=$(),m=p("div"),y=p("span"),w=h(C),b=$(),S=p("div"),Q.c(),E=$(),R=p("div"),V=p("span"),N=h(G),T=$(),z=p("div"),B=$(),_=p("div"),M=p("span"),I=h(q),P=$(),Y=p("div"),x(l,"class","svelte-6n71zn"),x(r,"class","sub-tile sub-tile-top svelte-6n71zn"),x(o,"class","sub-tile sub-tile-reward svelte-6n71zn"),k(o,"reward-is-negative",t[2]<0),x(y,"class","svelte-6n71zn"),x(m,"class","sub-tile sub-tile-left svelte-6n71zn"),x(S,"class","sub-tile sub-tile-middle svelte-6n71zn"),x(V,"class","svelte-6n71zn"),x(R,"class","sub-tile sub-tile-right svelte-6n71zn"),x(M,"class","svelte-6n71zn"),x(_,"class","sub-tile sub-tile-bottom svelte-6n71zn"),x(e,"class","tile svelte-6n71zn"),x(e,"style",t[5]),k(e,"blocked",t[0]),k(e,"terminal",t[1])},m(t,u){d(t,e,u),c(e,n),c(e,a),c(e,r),c(r,l),c(l,s),c(e,i),c(e,o),K.m(o,null),c(e,g),c(e,m),c(m,y),c(y,w),c(e,b),c(e,S),W[A].m(S,null),c(e,E),c(e,R),c(R,V),c(V,N),c(e,T),c(e,z),c(e,B),c(e,_),c(_,M),c(M,I),c(e,P),c(e,Y),j=!0},p(t,[n]){(!j||8&n)&&L!==(L=t[3][ot.up].toFixed(3)+"")&&v(s,L),J===(J=H(t,n))&&K?K.p(t,n):(K.d(1),K=J(t),K&&(K.c(),K.m(o,null))),4&n&&k(o,"reward-is-negative",t[2]<0),(!j||8&n)&&C!==(C=t[3][ot.left].toFixed(3)+"")&&v(w,C);let a=A;A=Z(t),A===a?W[A].p(t,n):(X(),O(W[a],1,1,(()=>{W[a]=null})),F(),Q=W[A],Q?Q.p(t,n):(Q=W[A]=U[A](t),Q.c()),D(Q,1),Q.m(S,null)),(!j||8&n)&&G!==(G=t[3][ot.right].toFixed(3)+"")&&v(N,G),(!j||8&n)&&q!==(q=t[3][ot.down].toFixed(3)+"")&&v(I,q),(!j||32&n)&&x(e,"style",t[5]),1&n&&k(e,"blocked",t[0]),2&n&&k(e,"terminal",t[1])},i(t){j||(D(Q),j=!0)},o(t){O(Q),j=!1},d(t){t&&f(e),K.d(),W[A].d()}}}const ot=Object.freeze({up:0,right:1,down:2,left:3});function ut(t,e,n){let a,r,l,s,i=!1,o=!1,u=0,c="";const d=()=>{r=Math.max(...a),l=a.indexOf(r),n(4,s=(90*l).toFixed())},f=()=>{n(3,a=Array(4).fill().map((()=>Math.random()))),d()};return f(),[i,o,u,a,s,c,()=>i,()=>{n(0,i=!0)},()=>o,()=>{n(1,o=!0)},()=>u,t=>{n(2,u=t)},()=>l,t=>o?u:a[t],()=>o?u:r,(t,e)=>{n(3,a[t]=e,a),d()},f,t=>{let e,a,r,l=.35+.6*t;i||(e=0+255*l,a=110+145*l,r=210+45*l,n(5,c="background: rgb("+e+","+a+","+r+", 1);"))}]}class ct extends U{constructor(t){super(),K(this,t,ut,it,i,{isBlocked:6,setBlocked:7,isTerminal:8,setTerminal:9,getReward:10,setReward:11,getPolicy:12,getQValue:13,getMaxQValue:14,setQValue:15,initQValues:16,setHeat:17})}get isBlocked(){return this.$$.ctx[6]}get setBlocked(){return this.$$.ctx[7]}get isTerminal(){return this.$$.ctx[8]}get setTerminal(){return this.$$.ctx[9]}get getReward(){return this.$$.ctx[10]}get setReward(){return this.$$.ctx[11]}get getPolicy(){return this.$$.ctx[12]}get getQValue(){return this.$$.ctx[13]}get getMaxQValue(){return this.$$.ctx[14]}get setQValue(){return this.$$.ctx[15]}get initQValues(){return this.$$.ctx[16]}get setHeat(){return this.$$.ctx[17]}}function dt(t,e,n){const a=t.slice();return a[22]=e[n],a[23]=e,a[24]=n,a}function ft(t,e,n){const a=t.slice();return a[22]=e[n],a[25]=e,a[26]=n,a}function gt(t){let e,n,a=t[26],r=t[24];const l=()=>t[19](e,a,r),s=()=>t[19](null,a,r);return e=new ct({props:{}}),l(),{c(){G(e.$$.fragment)},m(t,a){q(e,t,a),n=!0},p(t,n){a===t[26]&&r===t[24]||(s(),a=t[26],r=t[24],l());e.$set({})},i(t){n||(D(e.$$.fragment,t),n=!0)},o(t){O(e.$$.fragment,t),n=!1},d(t){s(),H(e,t)}}}function pt(t){let e,n,a=Array(t[0]),r=[];for(let e=0;e<a.length;e+=1)r[e]=gt(ft(t,a,e));const l=t=>O(r[t],1,1,(()=>{r[t]=null}));return{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=h("")},m(t,a){for(let e=0;e<r.length;e+=1)r[e].m(t,a);d(t,e,a),n=!0},p(t,n){if(5&n){let s;for(a=Array(t[0]),s=0;s<a.length;s+=1){const l=ft(t,a,s);r[s]?(r[s].p(l,n),D(r[s],1)):(r[s]=gt(l),r[s].c(),D(r[s],1),r[s].m(e.parentNode,e))}for(X(),s=a.length;s<r.length;s+=1)l(s);F()}},i(t){if(!n){for(let t=0;t<a.length;t+=1)D(r[t]);n=!0}},o(t){r=r.filter(Boolean);for(let t=0;t<r.length;t+=1)O(r[t]);n=!1},d(t){g(r,t),t&&f(e)}}}function mt(t){let e,n,a=Array(t[1]),r=[];for(let e=0;e<a.length;e+=1)r[e]=pt(dt(t,a,e));const l=t=>O(r[t],1,1,(()=>{r[t]=null}));return{c(){e=p("div");for(let t=0;t<r.length;t+=1)r[t].c();x(e,"class","maze svelte-csffwp"),w(e,"grid-template-columns","repeat("+t[0]+", 100px)")},m(t,a){d(t,e,a);for(let t=0;t<r.length;t+=1)r[t].m(e,null);n=!0},p(t,[s]){if(7&s){let n;for(a=Array(t[1]),n=0;n<a.length;n+=1){const l=dt(t,a,n);r[n]?(r[n].p(l,s),D(r[n],1)):(r[n]=pt(l),r[n].c(),D(r[n],1),r[n].m(e,null))}for(X(),n=a.length;n<r.length;n+=1)l(n);F()}(!n||1&s)&&w(e,"grid-template-columns","repeat("+t[0]+", 100px)")},i(t){if(!n){for(let t=0;t<a.length;t+=1)D(r[t]);n=!0}},o(t){r=r.filter(Boolean);for(let t=0;t<r.length;t+=1)O(r[t]);n=!1},d(t){t&&f(e),g(r,t)}}}function ht(t,e,n){let{numX:a}=e,{numY:r}=e,{blocked:l=[]}=e,{terminal:s=[]}=e,{rewards:i=[]}=e,{defaultReward:o=0}=e,u=Array.from({length:a},(()=>Array.from({length:r},(()=>null))));Q((()=>{l.forEach((t=>{u[t[0]][t[1]].setBlocked()})),s.forEach((t=>{u[t[0]][t[1]].setTerminal()}));for(let t=0;t<r;t++)for(let e=0;e<a;e++)u[e][t].setReward(o);i.forEach((t=>{u[t[0]][t[1]].setReward(t[2])})),g()}));const c=t=>Math.floor(Math.random()*Math.floor(t)),d=t=>u[t[0]][t[1]].isBlocked(),f=t=>u[t[0]][t[1]].isTerminal(),g=()=>{for(let t=0;t<r;t++)for(let e=0;e<a;e++)u[e][t].initQValues();$()},p=(t,e,n)=>{t[0]>=0&&t[0]<a&&t[1]>=0&&t[1]<r?(u[t[0]][t[1]].setQValue(e,n),$()):console.log("ERROR: Invalid setQValue coordinates [",t[0],":",t[1],"] !")},m=t=>u[t[0]][t[1]].getPolicy(),h=t=>t[0]>=0&&t[0]<a&&t[1]>=0&&t[1]<r?u[t[0]][t[1]].getReward():(console.log("ERROR: Invalid getReward coordinates [",t[0],":",t[1],"] !"),0),$=()=>{let t=1e6,e=-1e6;for(let n=0;n<r;n++)for(let r=0;r<a;r++){let a=u[r][n].getMaxQValue();t>a&&(t=a),e<a&&(e=a)}let n=e-t;for(let e=0;e<r;e++)for(let r=0;r<a;r++){let a=u[r][e].getMaxQValue();u[r][e].setHeat((a-t)/n)}};return t.$$set=t=>{"numX"in t&&n(0,a=t.numX),"numY"in t&&n(1,r=t.numY),"blocked"in t&&n(3,l=t.blocked),"terminal"in t&&n(4,s=t.terminal),"rewards"in t&&n(5,i=t.rewards),"defaultReward"in t&&n(6,o=t.defaultReward)},[a,r,u,l,s,i,o,c,d,f,g,p,(t,e)=>{for(let n=0;n<4;n++)p(t,n,e[n])},(t,e)=>u[t[0]][t[1]].getQValue(e),t=>u[t[0]][t[1]].getMaxQValue(),m,()=>{for(;;){let t=[c(a),c(r)];if(!f(t)&&!d(t))return t}},(t,e)=>Math.random()<e?c(4):m(t),(t,e)=>{let n=[...t];return e==ot.down&&t[1]<r-1&&(n[1]+=1),e==ot.right&&t[0]<a-1&&(n[0]+=1),e==ot.up&&t[1]>0&&(n[1]-=1),e==ot.left&&t[0]>0&&(n[0]-=1),d(n)&&(n=[...t]),[n,h(n)]},function(t,e,a){R[t?"unshift":"push"]((()=>{u[e][a]=t,n(2,u)}))}]}class $t extends U{constructor(t){super(),K(this,t,ht,mt,i,{numX:0,numY:1,blocked:3,terminal:4,rewards:5,defaultReward:6,getRandomInt:7,isBlocked:8,isTerminal:9,initQValues:10,setQValue:11,setQValues:12,getQValue:13,getMaxQValue:14,getPolicy:15,getRandomStartState:16,getEpsilonGreedyAction:17,step:18})}get getRandomInt(){return this.$$.ctx[7]}get isBlocked(){return this.$$.ctx[8]}get isTerminal(){return this.$$.ctx[9]}get initQValues(){return this.$$.ctx[10]}get setQValue(){return this.$$.ctx[11]}get setQValues(){return this.$$.ctx[12]}get getQValue(){return this.$$.ctx[13]}get getMaxQValue(){return this.$$.ctx[14]}get getPolicy(){return this.$$.ctx[15]}get getRandomStartState(){return this.$$.ctx[16]}get getEpsilonGreedyAction(){return this.$$.ctx[17]}get step(){return this.$$.ctx[18]}}function yt(t){let n;return{c(){n=p("div"),x(n,"class","plot svelte-1qi4jkb")},m(e,a){d(e,n,a),t[12](n)},p:e,i:e,o:e,d(e){e&&f(n),t[12](null)}}}function xt(t,e,n){let a,{title:r=""}=e,{xIsLog:l=!1}=e,{data:s=[]}=e,{yIsLog:i=!1}=e,{yTitle:o=""}=e,{hasSecondY:u=!1}=e,{dataSecond:c=[]}=e,{ySecondIsLog:d=!1}=e,{ySecondTitle:f=""}=e;const g=()=>{let t=s.length?-.02*s.length:-.02,e=s.length?1.02*s.length:1.02,n={title:r,showlegend:!1,xaxis:{type:l?"log":"linear",range:[t,e]},yaxis:{title:o,type:i?"log":"linear",range:[-1.1,1.1],titlefont:{color:"#08C"},tickfont:{color:"#08C"},autorange:!0},margin:{autoexpand:!1,t:50,l:40,b:30,r:20}};""!=o&&(n.margin.l=60);let g=[{x:[...Array(s.length).keys()],y:s,mode:"lines",line:{shape:"spline"},type:"scatter"}];if(u){n.yaxis2={title:f,type:d?"log":"linear",range:[-1.1,1.1],overlaying:"y",side:"right",titlefont:{color:"#E60"},tickfont:{color:"#E60"},autorange:!0},n.margin.r=""!=f?60:40;let t={x:[...Array(c.length).keys()],y:c,mode:"lines",line:{shape:"spline"},type:"scatter",yaxis:"y2"};g.push(t)}Plotly.react(a,g,n,{displaylogo:!1})};return Q((()=>{g()})),t.$$set=t=>{"title"in t&&n(3,r=t.title),"xIsLog"in t&&n(4,l=t.xIsLog),"data"in t&&n(1,s=t.data),"yIsLog"in t&&n(5,i=t.yIsLog),"yTitle"in t&&n(6,o=t.yTitle),"hasSecondY"in t&&n(7,u=t.hasSecondY),"dataSecond"in t&&n(2,c=t.dataSecond),"ySecondIsLog"in t&&n(8,d=t.ySecondIsLog),"ySecondTitle"in t&&n(9,f=t.ySecondTitle)},[a,s,c,r,l,i,o,u,d,f,g,()=>{n(1,s=[]),n(2,c=[]),g()},function(t){R[t?"unshift":"push"]((()=>{a=t,n(0,a)}))}]}class vt extends U{constructor(t){super(),K(this,t,xt,yt,i,{title:3,xIsLog:4,data:1,yIsLog:5,yTitle:6,hasSecondY:7,dataSecond:2,ySecondIsLog:8,ySecondTitle:9,updatePlot:10,clearPlot:11})}get updatePlot(){return this.$$.ctx[10]}get clearPlot(){return this.$$.ctx[11]}}function wt(t,e,n){let a=[],{maxData:r=1e3}=e;return t.$$set=t=>{"maxData"in t&&n(0,r=t.maxData)},[r,t=>{for(;a.length>=r;)a.shift();a.push(t)},t=>{let e=a.length;if(e<=t)return[...a];let n=new Array(t),r=new Array(e);for(;t--;){let l=Math.floor(Math.random()*e);n[t]=a[l in r?r[l]:l],r[l]=--e in r?r[e]:e}return n},()=>[...a],()=>{a=[]}]}class bt extends U{constructor(t){super(),K(this,t,wt,null,i,{maxData:0,add:1,getBatch:2,getAll:3,clear:4})}get add(){return this.$$.ctx[1]}get getBatch(){return this.$$.ctx[2]}get getAll(){return this.$$.ctx[3]}get clear(){return this.$$.ctx[4]}}function kt(t,e,n){let a,{duelingQNet:r=!1}=e;class l extends tf.layers.Layer{constructor(){super({})}getClassName(){return"DuelingLayer"}computeOutputShape(t){return t[0]}call(t,e){return tf.tidy((()=>{const e=t[0],n=t[1];return e.sub(e.mean(1).reshape([-1,1])).add(n)}))}}Q((()=>{s()}));const s=()=>{null!=a&&a.dispose(),r?o():i(),a.compile({optimizer:tf.train.adam(.005),loss:"meanSquaredError",metrics:["accuracy"]})},i=()=>{a=tf.sequential(),a.add(tf.layers.dense({inputShape:[2],units:10,useBias:!0,activation:"tanh"})),a.add(tf.layers.dense({units:10,useBias:!0,activation:"tanh"})),a.add(tf.layers.dense({units:10,useBias:!0,activation:"tanh"})),a.add(tf.layers.dense({units:4,useBias:!0,activation:"linear"}))},o=()=>{const t=tf.input({shape:[2]}),e=tf.layers.dense({units:10,useBias:!0,activation:"tanh"}).apply(t),n=tf.layers.dense({units:10,useBias:!0,activation:"tanh"}).apply(e),r=tf.layers.dense({units:10,useBias:!0,activation:"tanh"}).apply(n),s=tf.layers.dense({units:4,useBias:!0,activation:"linear"}).apply(r),i=tf.layers.dense({units:10,useBias:!0,activation:"tanh"}).apply(n),o=tf.layers.dense({units:1,useBias:!0,activation:"linear"}).apply(i),u=(new l).apply([s,o]);a=tf.model({inputs:t,outputs:u})};return t.$$set=t=>{"duelingQNet"in t&&n(0,r=t.duelingQNet)},[r,s,async(t,e)=>{const n=tf.tensor2d(t,[t.length,t[0].length],"float32"),r=tf.tensor2d(e,[e.length,e[0].length],"float32");await a.fit(n,r,{batchSize:t.length,epochs:10,shuffle:!0,callbacks:{}}),n.dispose(),r.dispose()},t=>{let e;return tf.tidy((()=>{const n=tf.tensor2d(t,[t.length,t[0].length],"float32");e=a.predict(n).arraySync()})),e},(t,e,n)=>{let a=[];return t.forEach(((t,r)=>{t-=(n[r]+e[r])/2,t/=(n[r]-e[r])/2,a.push(t)})),a}]}class St extends U{constructor(t){super(),K(this,t,kt,null,i,{duelingQNet:0,initModel:1,fit:2,predict:3,normalize:4})}get initModel(){return this.$$.ctx[1]}get fit(){return this.$$.ctx[2]}get predict(){return this.$$.ctx[3]}get normalize(){return this.$$.ctx[4]}}function At(t,e,n){const a=t.slice();return a[64]=e[n],a}function Qt(t){let n,a,r,l=t[64].name+"";return{c(){n=p("option"),a=h(l),n.__value=r=t[64].name,n.value=n.__value},m(t,e){d(t,n,e),c(n,a)},p:e,d(t){t&&f(n)}}}function Et(t){let e,n,a,r,s,i,o,u,m,S,A,Q,E,V,N,T,z,M,I,P,Y,j,L,X,F,J,K,U,W,Z,tt,et,nt,at,rt,lt,st,it,ot;function ut(e){t[28].call(null,e)}function ct(e){t[29].call(null,e)}let dt={yTitle:"reward per episode",ySecondTitle:"steps per episode",hasSecondY:!1};void 0!==t[9]&&(dt.data=t[9]),void 0!==t[8]&&(dt.dataSecond=t[8]),a=new vt({props:dt}),t[27](a),R.push((()=>C(a,"data",ut))),R.push((()=>C(a,"dataSecond",ct)));let ft=t[20],gt=[];for(let e=0;e<ft.length;e+=1)gt[e]=Qt(At(t,ft,e));let pt={numX:t[4],numY:t[5],blocked:t[0],terminal:t[1],rewards:t[2],defaultReward:t[3]};Z=new $t({props:pt}),t[33](Z);let mt={maxData:t[19]};et=new bt({props:mt}),t[34](et),at=new bt({props:{maxData:Tt}}),t[35](at);let ht={duelingQNet:t[16]};return lt=new St({props:ht}),t[36](lt),{c(){e=p("div"),n=p("div"),G(a.$$.fragment),i=$(),o=p("div"),u=h("EPISODE : "),m=h(t[11]),S=$(),A=p("div"),Q=p("select");for(let t=0;t<gt.length;t+=1)gt[t].c();E=$(),V=p("div"),N=p("input"),T=h("\n      DQN"),z=$(),M=p("div"),I=p("input"),P=h("\n      Dueling"),Y=$(),j=p("button"),j.textContent="init",L=$(),X=p("button"),X.textContent="halt",F=$(),J=p("button"),K=h("run"),U=$(),W=p("div"),G(Z.$$.fragment),tt=$(),G(et.$$.fragment),nt=$(),G(at.$$.fragment),rt=$(),G(lt.$$.fragment),x(n,"class","narrow-box svelte-akg5ju"),x(o,"class","box svelte-akg5ju"),x(Q,"class","svelte-akg5ju"),void 0===t[10]&&B((()=>t[30].call(Q))),x(N,"type","checkbox"),N.disabled=zt,x(N,"class","svelte-akg5ju"),x(V,"class","flexrow svelte-akg5ju"),k(V,"disabled",zt),x(I,"type","checkbox"),I.disabled=t[18],x(I,"class","svelte-akg5ju"),x(M,"class","flexrow svelte-akg5ju"),k(M,"disabled",t[18]),x(j,"class","svelte-akg5ju"),x(X,"class","svelte-akg5ju"),J.disabled=t[17],x(J,"class","svelte-akg5ju"),x(A,"class","box svelte-akg5ju"),x(W,"class","narrow-box svelte-akg5ju"),x(e,"class","container svelte-akg5ju"),w(e,"width",16+100*t[4]+4*(t[4]-1)+"px")},m(r,l){d(r,e,l),c(e,n),q(a,n,null),c(e,i),c(e,o),c(o,u),c(o,m),c(e,S),c(e,A),c(A,Q);for(let t=0;t<gt.length;t+=1)gt[t].m(Q,null);b(Q,t[10]),c(A,E),c(A,V),c(V,N),N.checked=t[15],c(V,T),c(A,z),c(A,M),c(M,I),I.checked=t[16],c(M,P),c(A,Y),c(A,j),c(A,L),c(A,X),c(A,F),c(A,J),c(J,K),c(e,U),c(e,W),q(Z,W,null),d(r,tt,l),q(et,r,l),d(r,nt,l),q(at,r,l),d(r,rt,l),q(lt,r,l),st=!0,it||(ot=[y(Q,"change",t[30]),y(Q,"change",t[23]),y(N,"change",t[31]),y(N,"change",t[23]),y(I,"change",t[32]),y(I,"change",t[23]),y(j,"click",t[23]),y(X,"click",t[22]),y(J,"click",t[21])],it=!0)},p(t,n){const l={};if(!r&&512&n[0]&&(r=!0,l.data=t[9],_((()=>r=!1))),!s&&256&n[0]&&(s=!0,l.dataSecond=t[8],_((()=>s=!1))),a.$set(l),(!st||2048&n[0])&&v(m,t[11]),1048576&n[0]){let e;for(ft=t[20],e=0;e<ft.length;e+=1){const a=At(t,ft,e);gt[e]?gt[e].p(a,n):(gt[e]=Qt(a),gt[e].c(),gt[e].m(Q,null))}for(;e<gt.length;e+=1)gt[e].d(1);gt.length=ft.length}1049600&n[0]&&b(Q,t[10]),32768&n[0]&&(N.checked=t[15]),0&n&&k(V,"disabled",zt),(!st||262144&n[0])&&(I.disabled=t[18]),65536&n[0]&&(I.checked=t[16]),262144&n[0]&&k(M,"disabled",t[18]),(!st||131072&n[0])&&(J.disabled=t[17]);const i={};16&n[0]&&(i.numX=t[4]),32&n[0]&&(i.numY=t[5]),1&n[0]&&(i.blocked=t[0]),2&n[0]&&(i.terminal=t[1]),4&n[0]&&(i.rewards=t[2]),8&n[0]&&(i.defaultReward=t[3]),Z.$set(i),(!st||16&n[0])&&w(e,"width",16+100*t[4]+4*(t[4]-1)+"px");et.$set({});at.$set({});const o={};65536&n[0]&&(o.duelingQNet=t[16]),lt.$set(o)},i(t){st||(D(a.$$.fragment,t),D(Z.$$.fragment,t),D(et.$$.fragment,t),D(at.$$.fragment,t),D(lt.$$.fragment,t),st=!0)},o(t){O(a.$$.fragment,t),O(Z.$$.fragment,t),O(et.$$.fragment,t),O(at.$$.fragment,t),O(lt.$$.fragment,t),st=!1},d(n){n&&f(e),t[27](null),H(a),g(gt,n),t[33](null),H(Z),n&&f(tt),t[34](null),H(et,n),n&&f(nt),t[35](null),H(at,n),n&&f(rt),t[36](null),H(lt,n),it=!1,l(ot)}}}const Rt=.1,Vt=.2,Nt=.9,Tt=2e3;let zt=!1;function Bt(t,e,n){let{blocked:a=[]}=e,{terminal:r=Array([0,0])}=e,{rewards:l=Array([0,0,1])}=e,{defaultReward:s=0}=e,{startState:i}=e,{numEpisodes:o=1e3}=e,{planningSteps:u=10}=e,{numX:c=5}=e,{numY:d=5}=e;const f=c*d;let g,p,m,h,$,y,x,v,w=[],b=[],k=0,S=0,A=0,E=0,V=!1,N=!1,T=!1,z=!0;const B=t=>v.normalize(t,[0,0],[c-1,d-1]);Q((()=>{for(let t=0;t<d;t++)for(let e=0;e<c;e++){let n=[e,t],a=B(n);y.add({state:n,normState:a})}}));const _=(t,e)=>{let n=e(t);g.setQValue(t.state,t.a,n)},M=async(t,e)=>{if(t.normState=B(t.state),x.add(t),E++,E<0)return;E=0;const n=x.getBatch(100);let a=[];n.forEach((t=>{a.push(t.normState)}));let r=v.predict(a);n.forEach(((t,n)=>{r[n][t.a]=e(t)})),await v.fit(a,r),y.getAll().forEach((t=>{let e=v.predict([t.normState]);g.setQValues(t.state,e[0])}))},I=t=>{let e;return e=g.isTerminal(t.stateNext)?t.r:t.r+Nt*g.getMaxQValue(t.stateNext),V?e:.8*g.getQValue(t.state,t.a)+Vt*e},P=t=>{let e,n,a;g.isTerminal(t)?(w.push(A),b.push(k),p.updatePlot(),J()):$=setTimeout((async()=>{n=g.getEpsilonGreedyAction(t,Rt),[e,a]=g.step(t,n),V?await M({state:t,a:n,r:a,stateNext:e},I):_({state:t,a:n,r:a,stateNext:e},I),t=[...e],k+=a,A++,P(t)}),0)},Y=t=>{let e;return e=g.isTerminal(t.stateNext)?t.r:t.r+Nt*g.getQValue(t.stateNext,t.aNext),V?e:.8*g.getQValue(t.state,t.a)+Vt*e},j=(t,e)=>{let n,a,r;g.isTerminal(t)?(w.push(A),b.push(k),p.updatePlot(),J()):$=setTimeout((async()=>{[n,r]=g.step(t,e),a=g.getEpsilonGreedyAction(n,Rt),V?await M({state:t,a:e,r:r,stateNext:n,aNext:a},Y):_({state:t,a:e,r:r,stateNext:n,aNext:a},Y),t=[...n],e=Number(a),k+=r,A++,j(t,e)}),0)},L=t=>{let e;if(g.isTerminal(t.stateNext))e=t.r;else{let n,a=0;n=.025;for(let e=0;e<4;e++)a+=n*g.getQValue(t.stateNext,e);n=.9;let r=g.getPolicy(t.stateNext);a+=n*g.getQValue(t.stateNext,r),e=t.r+Nt*a}return V?e:.8*g.getQValue(t.state,t.a)+Vt*e},X=(t,e)=>{let n,a,r;g.isTerminal(t)?(w.push(A),b.push(k),p.updatePlot(),J()):$=setTimeout((async()=>{[n,r]=g.step(t,e),a=g.getEpsilonGreedyAction(n,Rt),V?await M({state:t,a:e,r:r,stateNext:n,aNext:a},L):_({state:t,a:e,r:r,stateNext:n,aNext:a},L),t=[...n],e=Number(a),k+=r,A++,X(t,e)}),0)};let F=Array.from({length:c},(()=>Array.from({length:d},(()=>Array.from({length:4},(()=>null)))))),D=[];const O=()=>{let t=g.getRandomInt(D.length);return D[t]},C=t=>{let e,n,a;g.isTerminal(t)?(w.push(A),b.push(k),p.updatePlot(),J()):$=setTimeout((()=>{n=g.getEpsilonGreedyAction(t,Rt),[e,a]=g.step(t,n),_({state:t,a:n,r:a,stateNext:e},I),((t,e,n,a)=>{let r=t[0],l=t[1],s=!1;for(let t=0;t<D.length;t++)if(D[t][0]==r&&D[t][1]==l&&D[t][2]==e){s=!0;break}s||D.push([t,e]),F[r][l][e]=[a,n]})(t,n,a,e),t=[...e];for(let t=0;t<u;t++){let t,e,n,a;[t,e]=O(),[a,n]=F[t[0]][t[1]][e],_({state:t,a:e,r:n,stateNext:a},I)}k+=a,A++,C(t)}),0)};let G;const q=t=>{let e,n,a;g.isTerminal(t)?((()=>{for(let t=0;t<d;t++)for(let e=0;e<c;e++)for(let n=0;n<4;n++){let a=!1,r=0,l=1;for(let s=0;s<G.length;s++)e==G[s][0][0]&&t==G[s][0][1]&&n==G[s][1]&&(a=!0),a&&(r+=l*G[s][2],l*=Nt);if(a){let a=.8*g.getQValue([e,t],n)+Vt*r;g.setQValue([e,t],n,a)}}})(),w.push(A),b.push(k),p.updatePlot(),J()):$=setTimeout((()=>{n=g.getEpsilonGreedyAction(t,Rt),[e,a]=g.step(t,n),G.push([t,n,a]),t=[...e],k+=a,A++,q(t)}),0)},H=[{name:"Q-Learning",func:()=>{let t;k=0,A=0,t=i||g.getRandomStartState(),P(t)}},{name:"SARSA",func:()=>{let t,e;k=0,A=0,t=i||g.getRandomStartState(),e=g.getEpsilonGreedyAction(t,Rt),j(t,e)}},{name:"Expected SARSA",func:()=>{let t,e;k=0,A=0,t=i||g.getRandomStartState(),e=g.getEpsilonGreedyAction(t,Rt),X(t,e)}},{name:"Dyna-Q",func:()=>{let t;k=0,A=0,t=i||g.getRandomStartState(),C(t)}},{name:"Monte Carlo",func:()=>{let t;k=0,A=0,G=[],t=g.getRandomStartState(),q(t)}}],J=()=>{n(17,T=!0),h=setTimeout((()=>{S<o?(n(11,S++,S),H.forEach((t=>{m==t.name&&t.func()}))):n(17,T=!1)}),0)};return t.$$set=t=>{"blocked"in t&&n(0,a=t.blocked),"terminal"in t&&n(1,r=t.terminal),"rewards"in t&&n(2,l=t.rewards),"defaultReward"in t&&n(3,s=t.defaultReward),"startState"in t&&n(24,i=t.startState),"numEpisodes"in t&&n(25,o=t.numEpisodes),"planningSteps"in t&&n(26,u=t.planningSteps),"numX"in t&&n(4,c=t.numX),"numY"in t&&n(5,d=t.numY)},[a,r,l,s,c,d,g,p,w,b,m,S,y,x,v,V,N,T,z,f,H,J,()=>{h&&clearTimeout(h),$&&clearTimeout($),n(17,T=!1)},()=>{n(18,z=!V),z&&n(16,N=!1),n(11,S=0),n(8,w=[]),n(9,b=[]),g.initQValues(),p.clearPlot(),v.initModel(),x.clear()},i,o,u,function(t){R[t?"unshift":"push"]((()=>{p=t,n(7,p)}))},function(t){b=t,n(9,b)},function(t){w=t,n(8,w)},function(){m=function(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}(this),n(10,m),n(20,H)},function(){V=this.checked,n(15,V)},function(){N=this.checked,n(16,N)},function(t){R[t?"unshift":"push"]((()=>{g=t,n(6,g)}))},function(t){R[t?"unshift":"push"]((()=>{y=t,n(12,y)}))},function(t){R[t?"unshift":"push"]((()=>{x=t,n(13,x)}))},function(t){R[t?"unshift":"push"]((()=>{v=t,n(14,v)}))}]}class _t extends U{constructor(t){super(),K(this,t,Bt,Et,i,{blocked:0,terminal:1,rewards:2,defaultReward:3,startState:24,numEpisodes:25,planningSteps:26,numX:4,numY:5},[-1,-1,-1])}}const Mt=document.getElementById("maze-shell-0"),It=document.getElementById("maze-shell-1"),Pt=document.getElementById("maze-shell-2"),Yt=document.getElementById("maze-shell-3"),jt=document.getElementById("maze-shell-4"),Lt=Mt?new _t({target:Mt,props:{numX:12,numY:3,planningSteps:10,blocked:Array(),terminal:Array([1,2],[2,2],[3,2],[4,2],[5,2],[6,2],[7,2],[8,2],[9,2],[10,2],[11,2]),rewards:Array([1,2,-10],[2,2,-10],[3,2,-10],[4,2,-10],[5,2,-10],[6,2,-10],[7,2,-10],[8,2,-10],[9,2,-10],[10,2,-10],[11,2,0]),defaultReward:-.1,startState:[0,2]}}):null,Xt=It?new _t({target:It,props:{numX:7,numY:3,planningSteps:10,blocked:Array(),terminal:Array([1,2],[2,2],[3,2],[4,2],[5,2],[6,2]),rewards:Array([1,2,-10],[2,2,-10],[3,2,-10],[4,2,-10],[5,2,-10],[6,2,0]),defaultReward:-.1,startState:[0,2]}}):null,Ft=Pt?new _t({target:Pt,props:{numX:5,numY:5,blocked:Array(),terminal:Array([1,1]),rewards:Array([1,1,1]),defaultReward:-.1}}):null,Dt=Yt?new _t({target:Yt,props:{numX:5,numY:5,blocked:Array(),terminal:Array([1,1]),rewards:Array([1,1,1],[3,3,1]),defaultReward:-.1}}):null,Ot=jt?new _t({target:jt,props:{numX:6,numY:4,blocked:Array([0,0],[3,2],[4,1],[3,3]),terminal:Array([1,1]),rewards:Array([1,1,1]),defaultReward:-.1}}):null;return t.comp0=Lt,t.comp1=Xt,t.comp2=Ft,t.comp3=Dt,t.comp4=Ot,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
//# sourceMappingURL=bundle.js.map
