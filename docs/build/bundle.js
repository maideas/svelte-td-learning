var app=function(t){"use strict";function e(){}function n(t,e){for(const n in e)t[n]=e[n];return t}function r(t){return t()}function l(){return Object.create(null)}function a(t){t.forEach(r)}function s(t){return"function"==typeof t}function o(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function i(t){const e={};for(const n in t)"$"!==n[0]&&(e[n]=t[n]);return e}function c(t){return null==t?"":t}function u(t,e){t.appendChild(e)}function d(t,e,n){t.insertBefore(e,n||null)}function f(t){t.parentNode.removeChild(t)}function g(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function m(t){return document.createElement(t)}function p(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function h(t){return document.createTextNode(t)}function $(){return h(" ")}function x(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function y(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function v(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function w(t,e,n,r){t.style.setProperty(e,n,r?"important":"")}function b(t,e){for(let n=0;n<t.options.length;n+=1){const r=t.options[n];if(r.__value===e)return void(r.selected=!0)}}function S(t,e,n){t.classList[n?"add":"remove"](e)}let k;function A(t){k=t}function E(t){(function(){if(!k)throw new Error("Function called outside component initialization");return k})().$$.on_mount.push(t)}const R=[],Q=[],T=[],V=[],z=Promise.resolve();let N=!1;function _(t){T.push(t)}function B(t){V.push(t)}let M=!1;const I=new Set;function P(){if(!M){M=!0;do{for(let t=0;t<R.length;t+=1){const e=R[t];A(e),Y(e.$$)}for(A(null),R.length=0;Q.length;)Q.pop()();for(let t=0;t<T.length;t+=1){const e=T[t];I.has(e)||(I.add(e),e())}T.length=0}while(R.length);for(;V.length;)V.pop()();N=!1,M=!1,I.clear()}}function Y(t){if(null!==t.fragment){t.update(),a(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(_)}}const L=new Set;let X;function F(){X={r:0,c:[],p:X}}function C(){X.r||a(X.c),X=X.p}function G(t,e){t&&t.i&&(L.delete(t),t.i(e))}function O(t,e,n,r){if(t&&t.o){if(L.has(t))return;L.add(t),X.c.push((()=>{L.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}}function D(t,e,n){const r=t.$$.props[e];void 0!==r&&(t.$$.bound[r]=n,n(t.$$.ctx[r]))}function j(t){t&&t.c()}function q(t,e,n){const{fragment:l,on_mount:o,on_destroy:i,after_update:c}=t.$$;l&&l.m(e,n),_((()=>{const e=o.map(r).filter(s);i?i.push(...e):a(e),t.$$.on_mount=[]})),c.forEach(_)}function H(t,e){const n=t.$$;null!==n.fragment&&(a(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function J(t,e){-1===t.$$.dirty[0]&&(R.push(t),N||(N=!0,z.then(P)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function K(t,n,r,s,o,i,c=[-1]){const u=k;A(t);const d=n.props||{},g=t.$$={fragment:null,ctx:null,props:i,update:e,not_equal:o,bound:l(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(u?u.$$.context:[]),callbacks:l(),dirty:c,skip_bound:!1};let m=!1;if(g.ctx=r?r(t,d,((e,n,...r)=>{const l=r.length?r[0]:n;return g.ctx&&o(g.ctx[e],g.ctx[e]=l)&&(!g.skip_bound&&g.bound[e]&&g.bound[e](l),m&&J(t,e)),n})):[],g.update(),m=!0,a(g.before_update),g.fragment=!!s&&s(g.ctx),n.target){if(n.hydrate){const t=function(t){return Array.from(t.childNodes)}(n.target);g.fragment&&g.fragment.l(t),t.forEach(f)}else g.fragment&&g.fragment.c();n.intro&&G(t.$$.fragment),q(t,n.target,n.anchor),P()}A(u)}class U{$destroy(){H(this,1),this.$destroy=e}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function W(t){let n,r,l;return{c(){n=p("svg"),r=p("path"),y(r,"fill","currentColor"),y(r,"d",t[0]),y(n,"aria-hidden","true"),y(n,"class",l=c(t[1])+" svelte-1d15yci"),y(n,"role","img"),y(n,"xmlns","http://www.w3.org/2000/svg"),y(n,"viewBox",t[2])},m(t,e){d(t,n,e),u(n,r)},p(t,[e]){1&e&&y(r,"d",t[0]),2&e&&l!==(l=c(t[1])+" svelte-1d15yci")&&y(n,"class",l),4&e&&y(n,"viewBox",t[2])},i:e,o:e,d(t){t&&f(n)}}}function Z(t,e,r){let{icon:l}=e,a=[],s="",o="";return t.$$set=t=>{r(4,e=n(n({},e),i(t))),"icon"in t&&r(3,l=t.icon)},t.$$.update=()=>{8&t.$$.dirty&&r(2,o="0 0 "+l.icon[0]+" "+l.icon[1]),r(1,s="fa-svelte "+(e.class?e.class:"")),8&t.$$.dirty&&r(0,a=l.icon[4])},e=i(e),[a,s,o,l]}class tt extends U{constructor(t){super(),K(this,t,Z,W,o,{icon:3})}}
/*!
     * Font Awesome Free 5.15.1 by @fontawesome - https://fontawesome.com
     * License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)
     */var et={prefix:"far",iconName:"arrow-alt-circle-up",icon:[512,512,[],"f35b","M256 504c137 0 248-111 248-248S393 8 256 8 8 119 8 256s111 248 248 248zm0-448c110.5 0 200 89.5 200 200s-89.5 200-200 200S56 366.5 56 256 145.5 56 256 56zm20 328h-40c-6.6 0-12-5.4-12-12V256h-67c-10.7 0-16-12.9-8.5-20.5l99-99c4.7-4.7 12.3-4.7 17 0l99 99c7.6 7.6 2.2 20.5-8.5 20.5h-67v116c0 6.6-5.4 12-12 12z"]};function nt(t){let e,n,r=t[2].toFixed()+"";return{c(){e=m("span"),n=h(r),y(e,"class","svelte-6n71zn")},m(t,r){d(t,e,r),u(e,n)},p(t,e){4&e&&r!==(r=t[2].toFixed()+"")&&v(n,r)},d(t){t&&f(e)}}}function rt(t){let e,n,r=t[2].toFixed(1)+"";return{c(){e=m("span"),n=h(r),y(e,"class","svelte-6n71zn")},m(t,r){d(t,e,r),u(e,n)},p(t,e){4&e&&r!==(r=t[2].toFixed(1)+"")&&v(n,r)},d(t){t&&f(e)}}}function lt(t){let e,n,r;return n=new tt({props:{icon:et}}),{c(){e=m("div"),j(n.$$.fragment),w(e,"font-size","32px"),w(e,"transform","rotate("+t[4]+"deg)"),y(e,"class","svelte-6n71zn")},m(t,l){d(t,e,l),q(n,e,null),r=!0},p(t,n){(!r||16&n)&&w(e,"transform","rotate("+t[4]+"deg)")},i(t){r||(G(n.$$.fragment,t),r=!0)},o(t){O(n.$$.fragment,t),r=!1},d(t){t&&f(e),H(n)}}}function at(t){let n;return{c(){n=h("terminal state")},m(t,e){d(t,n,e)},p:e,i:e,o:e,d(t){t&&f(n)}}}function st(t){let n;return{c(){n=h("blocked")},m(t,e){d(t,n,e)},p:e,i:e,o:e,d(t){t&&f(n)}}}function ot(t){let e,n,r,l,a,s,o,i,c,g,p,x,w,b,k,A,E,R,Q,T,V,z,N,_,B,M,I,P,Y,L,X=t[3][it.up].toFixed(3)+"",D=t[3][it.left].toFixed(3)+"",j=t[3][it.right].toFixed(3)+"",q=t[3][it.down].toFixed(3)+"";function H(t,e){return(null==c||4&e)&&(c=!!(Math.abs(t[2])<10)),c?rt:nt}let J=H(t,-1),K=J(t);const U=[st,at,lt],W=[];function Z(t,e){return t[0]?0:t[1]?1:2}return A=Z(t),E=W[A]=U[A](t),{c(){e=m("div"),n=m("div"),r=$(),l=m("div"),a=m("span"),s=h(X),o=$(),i=m("div"),K.c(),g=$(),p=m("div"),x=m("span"),w=h(D),b=$(),k=m("div"),E.c(),R=$(),Q=m("div"),T=m("span"),V=h(j),z=$(),N=m("div"),_=$(),B=m("div"),M=m("span"),I=h(q),P=$(),Y=m("div"),y(a,"class","svelte-6n71zn"),y(l,"class","sub-tile sub-tile-top svelte-6n71zn"),y(i,"class","sub-tile sub-tile-reward svelte-6n71zn"),S(i,"reward-is-negative",t[2]<0),y(x,"class","svelte-6n71zn"),y(p,"class","sub-tile sub-tile-left svelte-6n71zn"),y(k,"class","sub-tile sub-tile-middle svelte-6n71zn"),y(T,"class","svelte-6n71zn"),y(Q,"class","sub-tile sub-tile-right svelte-6n71zn"),y(M,"class","svelte-6n71zn"),y(B,"class","sub-tile sub-tile-bottom svelte-6n71zn"),y(e,"class","tile svelte-6n71zn"),y(e,"style",t[5]),S(e,"blocked",t[0]),S(e,"terminal",t[1])},m(t,c){d(t,e,c),u(e,n),u(e,r),u(e,l),u(l,a),u(a,s),u(e,o),u(e,i),K.m(i,null),u(e,g),u(e,p),u(p,x),u(x,w),u(e,b),u(e,k),W[A].m(k,null),u(e,R),u(e,Q),u(Q,T),u(T,V),u(e,z),u(e,N),u(e,_),u(e,B),u(B,M),u(M,I),u(e,P),u(e,Y),L=!0},p(t,[n]){(!L||8&n)&&X!==(X=t[3][it.up].toFixed(3)+"")&&v(s,X),J===(J=H(t,n))&&K?K.p(t,n):(K.d(1),K=J(t),K&&(K.c(),K.m(i,null))),4&n&&S(i,"reward-is-negative",t[2]<0),(!L||8&n)&&D!==(D=t[3][it.left].toFixed(3)+"")&&v(w,D);let r=A;A=Z(t),A===r?W[A].p(t,n):(F(),O(W[r],1,1,(()=>{W[r]=null})),C(),E=W[A],E?E.p(t,n):(E=W[A]=U[A](t),E.c()),G(E,1),E.m(k,null)),(!L||8&n)&&j!==(j=t[3][it.right].toFixed(3)+"")&&v(V,j),(!L||8&n)&&q!==(q=t[3][it.down].toFixed(3)+"")&&v(I,q),(!L||32&n)&&y(e,"style",t[5]),1&n&&S(e,"blocked",t[0]),2&n&&S(e,"terminal",t[1])},i(t){L||(G(E),L=!0)},o(t){O(E),L=!1},d(t){t&&f(e),K.d(),W[A].d()}}}const it=Object.freeze({up:0,right:1,down:2,left:3});function ct(t,e,n){let r,l,a,s,o=!1,i=!1,c=0,u="";const d=()=>{l=Math.max(...r),a=r.indexOf(l),n(4,s=(90*a).toFixed())},f=()=>{n(3,r=Array(4).fill().map((()=>Math.random()))),d()};return f(),[o,i,c,r,s,u,()=>o,()=>{n(0,o=!0)},()=>i,()=>{n(1,i=!0)},()=>c,t=>{n(2,c=t)},()=>a,t=>i?c:r[t],()=>i?c:l,(t,e)=>{n(3,r[t]=e,r),d()},f,t=>{let e,r,l,a=.35+.6*t;o||(e=0+255*a,r=110+145*a,l=210+45*a,n(5,u="background: rgb("+e+","+r+","+l+", 1);"))}]}class ut extends U{constructor(t){super(),K(this,t,ct,ot,o,{isBlocked:6,setBlocked:7,isTerminal:8,setTerminal:9,getReward:10,setReward:11,getPolicy:12,getQValue:13,getMaxQValue:14,setQValue:15,initQValues:16,setHeat:17})}get isBlocked(){return this.$$.ctx[6]}get setBlocked(){return this.$$.ctx[7]}get isTerminal(){return this.$$.ctx[8]}get setTerminal(){return this.$$.ctx[9]}get getReward(){return this.$$.ctx[10]}get setReward(){return this.$$.ctx[11]}get getPolicy(){return this.$$.ctx[12]}get getQValue(){return this.$$.ctx[13]}get getMaxQValue(){return this.$$.ctx[14]}get setQValue(){return this.$$.ctx[15]}get initQValues(){return this.$$.ctx[16]}get setHeat(){return this.$$.ctx[17]}}function dt(t,e,n){const r=t.slice();return r[21]=e[n],r[22]=e,r[23]=n,r}function ft(t,e,n){const r=t.slice();return r[21]=e[n],r[24]=e,r[25]=n,r}function gt(t){let e,n,r=t[25],l=t[23];const a=()=>t[18](e,r,l),s=()=>t[18](null,r,l);return e=new ut({props:{}}),a(),{c(){j(e.$$.fragment)},m(t,r){q(e,t,r),n=!0},p(t,n){r===t[25]&&l===t[23]||(s(),r=t[25],l=t[23],a());e.$set({})},i(t){n||(G(e.$$.fragment,t),n=!0)},o(t){O(e.$$.fragment,t),n=!1},d(t){s(),H(e,t)}}}function mt(t){let e,n,r=Array(t[0]),l=[];for(let e=0;e<r.length;e+=1)l[e]=gt(ft(t,r,e));const a=t=>O(l[t],1,1,(()=>{l[t]=null}));return{c(){for(let t=0;t<l.length;t+=1)l[t].c();e=h("")},m(t,r){for(let e=0;e<l.length;e+=1)l[e].m(t,r);d(t,e,r),n=!0},p(t,n){if(5&n){let s;for(r=Array(t[0]),s=0;s<r.length;s+=1){const a=ft(t,r,s);l[s]?(l[s].p(a,n),G(l[s],1)):(l[s]=gt(a),l[s].c(),G(l[s],1),l[s].m(e.parentNode,e))}for(F(),s=r.length;s<l.length;s+=1)a(s);C()}},i(t){if(!n){for(let t=0;t<r.length;t+=1)G(l[t]);n=!0}},o(t){l=l.filter(Boolean);for(let t=0;t<l.length;t+=1)O(l[t]);n=!1},d(t){g(l,t),t&&f(e)}}}function pt(t){let e,n,r=Array(t[1]),l=[];for(let e=0;e<r.length;e+=1)l[e]=mt(dt(t,r,e));const a=t=>O(l[t],1,1,(()=>{l[t]=null}));return{c(){e=m("div");for(let t=0;t<l.length;t+=1)l[t].c();y(e,"class","maze svelte-csffwp"),w(e,"grid-template-columns","repeat("+t[0]+", 100px)")},m(t,r){d(t,e,r);for(let t=0;t<l.length;t+=1)l[t].m(e,null);n=!0},p(t,[s]){if(7&s){let n;for(r=Array(t[1]),n=0;n<r.length;n+=1){const a=dt(t,r,n);l[n]?(l[n].p(a,s),G(l[n],1)):(l[n]=mt(a),l[n].c(),G(l[n],1),l[n].m(e,null))}for(F(),n=r.length;n<l.length;n+=1)a(n);C()}(!n||1&s)&&w(e,"grid-template-columns","repeat("+t[0]+", 100px)")},i(t){if(!n){for(let t=0;t<r.length;t+=1)G(l[t]);n=!0}},o(t){l=l.filter(Boolean);for(let t=0;t<l.length;t+=1)O(l[t]);n=!1},d(t){t&&f(e),g(l,t)}}}function ht(t,e,n){let{numX:r}=e,{numY:l}=e,{blocked:a=[]}=e,{terminal:s=[]}=e,{rewards:o=[]}=e,{defaultReward:i=0}=e,c=Array.from({length:r},(()=>Array.from({length:l},(()=>null))));E((()=>{a.forEach((t=>{c[t[0]][t[1]].setBlocked()})),s.forEach((t=>{c[t[0]][t[1]].setTerminal()}));for(let t=0;t<l;t++)for(let e=0;e<r;e++)c[e][t].setReward(i);o.forEach((t=>{c[t[0]][t[1]].setReward(t[2])})),g()}));const u=t=>Math.floor(Math.random()*Math.floor(t)),d=t=>c[t[0]][t[1]].isBlocked(),f=t=>c[t[0]][t[1]].isTerminal(),g=()=>{for(let t=0;t<l;t++)for(let e=0;e<r;e++)c[e][t].initQValues();h()},m=t=>c[t[0]][t[1]].getPolicy(),p=t=>t[0]>=0&&t[0]<r&&t[1]>=0&&t[1]<l?c[t[0]][t[1]].getReward():(console.log("ERROR: Invalid getReward coordinates [",t[0],":",t[1],"] !"),0),h=()=>{let t=1e6,e=-1e6;for(let n=0;n<l;n++)for(let l=0;l<r;l++){let r=c[l][n].getMaxQValue();t>r&&(t=r),e<r&&(e=r)}let n=e-t;for(let e=0;e<l;e++)for(let l=0;l<r;l++){let r=c[l][e].getMaxQValue();c[l][e].setHeat((r-t)/n)}};return t.$$set=t=>{"numX"in t&&n(0,r=t.numX),"numY"in t&&n(1,l=t.numY),"blocked"in t&&n(3,a=t.blocked),"terminal"in t&&n(4,s=t.terminal),"rewards"in t&&n(5,o=t.rewards),"defaultReward"in t&&n(6,i=t.defaultReward)},[r,l,c,a,s,o,i,u,d,f,g,(t,e,n)=>{t[0]>=0&&t[0]<r&&t[1]>=0&&t[1]<l?(c[t[0]][t[1]].setQValue(e,n),h()):console.log("ERROR: Invalid setQValue coordinates [",t[0],":",t[1],"] !")},(t,e)=>c[t[0]][t[1]].getQValue(e),t=>c[t[0]][t[1]].getMaxQValue(),m,()=>{for(;;){let t=[u(r),u(l)];if(!f(t)&&!d(t))return t}},(t,e)=>Math.random()<e?u(4):m(t),(t,e)=>{let n=[...t];return e==it.down&&t[1]<l-1&&(n[1]+=1),e==it.right&&t[0]<r-1&&(n[0]+=1),e==it.up&&t[1]>0&&(n[1]-=1),e==it.left&&t[0]>0&&(n[0]-=1),d(n)&&(n=[...t]),[n,p(n)]},function(t,e,r){Q[t?"unshift":"push"]((()=>{c[e][r]=t,n(2,c)}))}]}class $t extends U{constructor(t){super(),K(this,t,ht,pt,o,{numX:0,numY:1,blocked:3,terminal:4,rewards:5,defaultReward:6,getRandomInt:7,isBlocked:8,isTerminal:9,initQValues:10,setQValue:11,getQValue:12,getMaxQValue:13,getPolicy:14,getRandomStartState:15,getEpsilonGreedyAction:16,step:17})}get getRandomInt(){return this.$$.ctx[7]}get isBlocked(){return this.$$.ctx[8]}get isTerminal(){return this.$$.ctx[9]}get initQValues(){return this.$$.ctx[10]}get setQValue(){return this.$$.ctx[11]}get getQValue(){return this.$$.ctx[12]}get getMaxQValue(){return this.$$.ctx[13]}get getPolicy(){return this.$$.ctx[14]}get getRandomStartState(){return this.$$.ctx[15]}get getEpsilonGreedyAction(){return this.$$.ctx[16]}get step(){return this.$$.ctx[17]}}function xt(t){let n;return{c(){n=m("div"),y(n,"class","plot svelte-1qi4jkb")},m(e,r){d(e,n,r),t[12](n)},p:e,i:e,o:e,d(e){e&&f(n),t[12](null)}}}function yt(t,e,n){let r,{title:l=""}=e,{xIsLog:a=!1}=e,{data:s=[]}=e,{yIsLog:o=!1}=e,{yTitle:i=""}=e,{hasSecondY:c=!1}=e,{dataSecond:u=[]}=e,{ySecondIsLog:d=!1}=e,{ySecondTitle:f=""}=e;const g=()=>{let t=s.length?-.02*s.length:-.02,e=s.length?1.02*s.length:1.02,n={title:l,showlegend:!1,xaxis:{type:a?"log":"linear",range:[t,e]},yaxis:{title:i,type:o?"log":"linear",range:[-1.1,1.1],titlefont:{color:"#08C"},tickfont:{color:"#08C"},autorange:!0},margin:{autoexpand:!1,t:50,l:40,b:30,r:20}};""!=i&&(n.margin.l=60);let g=[{x:[...Array(s.length).keys()],y:s,mode:"lines",line:{shape:"spline"},type:"scatter"}];if(c){n.yaxis2={title:f,type:d?"log":"linear",range:[-1.1,1.1],overlaying:"y",side:"right",titlefont:{color:"#E60"},tickfont:{color:"#E60"},autorange:!0},n.margin.r=""!=f?60:40;let t={x:[...Array(u.length).keys()],y:u,mode:"lines",line:{shape:"spline"},type:"scatter",yaxis:"y2"};g.push(t)}Plotly.react(r,g,n,{displaylogo:!1})};return E((()=>{g()})),t.$$set=t=>{"title"in t&&n(3,l=t.title),"xIsLog"in t&&n(4,a=t.xIsLog),"data"in t&&n(1,s=t.data),"yIsLog"in t&&n(5,o=t.yIsLog),"yTitle"in t&&n(6,i=t.yTitle),"hasSecondY"in t&&n(7,c=t.hasSecondY),"dataSecond"in t&&n(2,u=t.dataSecond),"ySecondIsLog"in t&&n(8,d=t.ySecondIsLog),"ySecondTitle"in t&&n(9,f=t.ySecondTitle)},[r,s,u,l,a,o,i,c,d,f,g,()=>{n(1,s=[]),n(2,u=[]),g()},function(t){Q[t?"unshift":"push"]((()=>{r=t,n(0,r)}))}]}class vt extends U{constructor(t){super(),K(this,t,yt,xt,o,{title:3,xIsLog:4,data:1,yIsLog:5,yTitle:6,hasSecondY:7,dataSecond:2,ySecondIsLog:8,ySecondTitle:9,updatePlot:10,clearPlot:11})}get updatePlot(){return this.$$.ctx[10]}get clearPlot(){return this.$$.ctx[11]}}function wt(t,e,n){let r=[],{maxData:l=1e3}=e;return t.$$set=t=>{"maxData"in t&&n(0,l=t.maxData)},[l,t=>{for(;r.length>=l;)r.shift();r.push(t)},t=>{let e=r.length;if(e<=t)return[...r];let n=new Array(t),l=new Array(e);for(;t--;){let a=Math.floor(Math.random()*e);n[t]=r[a in l?l[a]:a],l[a]=--e in l?l[e]:e}return n},()=>{r=[]}]}class bt extends U{constructor(t){super(),K(this,t,wt,null,o,{maxData:0,add:1,getBatch:2,clear:3})}get add(){return this.$$.ctx[1]}get getBatch(){return this.$$.ctx[2]}get clear(){return this.$$.ctx[3]}}function St(t,e,n){let r;E((()=>{r=l()}));const l=()=>{const t=tf.sequential();return t.add(tf.layers.dense({inputShape:[2],units:10,useBias:!0,activation:"tanh"})),t.add(tf.layers.dense({units:10,useBias:!0,activation:"tanh"})),t.add(tf.layers.dense({units:10,useBias:!0,activation:"tanh"})),t.add(tf.layers.dense({units:4,useBias:!0,activation:"linear"})),t.compile({optimizer:tf.train.adam(.005),loss:"meanSquaredError",metrics:["accuracy"]}),t};return[()=>{r.resetStates()},(t,e)=>{const n=tf.tensor2d(t,[t.length,t[0].length],"float32"),l=tf.tensor2d(e,[e.length,e[0].length],"float32");return r.fit(n,l,{batchSize:t.length,epochs:10,shuffle:!0,callbacks:{}})},t=>{const e=tf.tensor2d(t,[t.length,t[0].length],"float32");return r.predict(e).array()},(t,e,n)=>{let r=[];return t.forEach(((t,l)=>{t-=(n[l]+e[l])/2,t/=(n[l]-e[l])/2,r.push(t)})),r}]}class kt extends U{constructor(t){super(),K(this,t,St,null,o,{resetModel:0,fit:1,predict:2,normalize:3})}get resetModel(){return this.$$.ctx[0]}get fit(){return this.$$.ctx[1]}get predict(){return this.$$.ctx[2]}get normalize(){return this.$$.ctx[3]}}function At(t,e,n){const r=t.slice();return r[56]=e[n],r}function Et(t){let n,r,l,a=t[56].name+"";return{c(){n=m("option"),r=h(a),n.__value=l=t[56].name,n.value=n.__value},m(t,e){d(t,n,e),u(n,r)},p:e,d(t){t&&f(n)}}}function Rt(t){let e,n,r,l,s,o,i,c,p,S,k,A,E,R,T,V,z,N,M,I,P,Y,L,X,F,C,J,K,U,W,Z,tt;function et(e){t[23].call(null,e)}function nt(e){t[24].call(null,e)}let rt={yTitle:"reward per episode",ySecondTitle:"steps per episode",hasSecondY:!1};void 0!==t[9]&&(rt.data=t[9]),void 0!==t[8]&&(rt.dataSecond=t[8]),r=new vt({props:rt}),t[22](r),Q.push((()=>D(r,"data",et))),Q.push((()=>D(r,"dataSecond",nt)));let lt=t[15],at=[];for(let e=0;e<lt.length;e+=1)at[e]=Et(At(t,lt,e));let st={numX:t[4],numY:t[5],blocked:t[0],terminal:t[1],rewards:t[2],defaultReward:t[3]};F=new $t({props:st}),t[27](F),J=new bt({props:{maxData:zt}}),t[28](J);return U=new kt({props:{}}),t[29](U),{c(){e=m("div"),n=m("div"),j(r.$$.fragment),o=$(),i=m("div"),c=h("EPISODE : "),p=h(t[11]),S=$(),k=m("div"),A=m("select");for(let t=0;t<at.length;t+=1)at[t].c();E=$(),R=m("div"),T=m("input"),V=h("\n      DQN"),z=$(),N=m("button"),N.textContent="init",M=$(),I=m("button"),I.textContent="halt",P=$(),Y=m("button"),Y.textContent="run",L=$(),X=m("div"),j(F.$$.fragment),C=$(),j(J.$$.fragment),K=$(),j(U.$$.fragment),y(n,"class","narrow-box svelte-fcgxyy"),y(i,"class","box svelte-fcgxyy"),y(A,"class","svelte-fcgxyy"),void 0===t[10]&&_((()=>t[25].call(A))),y(T,"type","checkbox"),y(T,"class","svelte-fcgxyy"),y(R,"class","flex svelte-fcgxyy"),y(N,"class","svelte-fcgxyy"),y(I,"class","svelte-fcgxyy"),y(Y,"class","svelte-fcgxyy"),y(k,"class","box svelte-fcgxyy"),y(X,"class","narrow-box svelte-fcgxyy"),y(e,"class","container svelte-fcgxyy"),w(e,"width",16+100*t[4]+4*(t[4]-1)+"px")},m(l,a){d(l,e,a),u(e,n),q(r,n,null),u(e,o),u(e,i),u(i,c),u(i,p),u(e,S),u(e,k),u(k,A);for(let t=0;t<at.length;t+=1)at[t].m(A,null);b(A,t[10]),u(k,E),u(k,R),u(R,T),T.checked=t[14],u(R,V),u(k,z),u(k,N),u(k,M),u(k,I),u(k,P),u(k,Y),u(e,L),u(e,X),q(F,X,null),d(l,C,a),q(J,l,a),d(l,K,a),q(U,l,a),W=!0,Z||(tt=[x(A,"change",t[25]),x(A,"change",t[18]),x(T,"change",t[26]),x(T,"change",t[18]),x(N,"click",t[18]),x(I,"click",t[17]),x(Y,"click",t[16])],Z=!0)},p(t,n){const a={};if(!l&&512&n[0]&&(l=!0,a.data=t[9],B((()=>l=!1))),!s&&256&n[0]&&(s=!0,a.dataSecond=t[8],B((()=>s=!1))),r.$set(a),(!W||2048&n[0])&&v(p,t[11]),32768&n[0]){let e;for(lt=t[15],e=0;e<lt.length;e+=1){const r=At(t,lt,e);at[e]?at[e].p(r,n):(at[e]=Et(r),at[e].c(),at[e].m(A,null))}for(;e<at.length;e+=1)at[e].d(1);at.length=lt.length}33792&n[0]&&b(A,t[10]),16384&n[0]&&(T.checked=t[14]);const o={};16&n[0]&&(o.numX=t[4]),32&n[0]&&(o.numY=t[5]),1&n[0]&&(o.blocked=t[0]),2&n[0]&&(o.terminal=t[1]),4&n[0]&&(o.rewards=t[2]),8&n[0]&&(o.defaultReward=t[3]),F.$set(o),(!W||16&n[0])&&w(e,"width",16+100*t[4]+4*(t[4]-1)+"px");J.$set({});U.$set({})},i(t){W||(G(r.$$.fragment,t),G(F.$$.fragment,t),G(J.$$.fragment,t),G(U.$$.fragment,t),W=!0)},o(t){O(r.$$.fragment,t),O(F.$$.fragment,t),O(J.$$.fragment,t),O(U.$$.fragment,t),W=!1},d(n){n&&f(e),t[22](null),H(r),g(at,n),t[27](null),H(F),n&&f(C),t[28](null),H(J,n),n&&f(K),t[29](null),H(U,n),Z=!1,a(tt)}}}const Qt=.1,Tt=.2,Vt=.9,zt=2e3;function Nt(t,e,n){let r,l,a,s,o,i,c,{blocked:u=[]}=e,{terminal:d=Array([0,0])}=e,{rewards:f=Array([0,0,1])}=e,{defaultReward:g=0}=e,{startState:m}=e,{numEpisodes:p=1e3}=e,{planningSteps:h=10}=e,{numX:$=5}=e,{numY:x=5}=e,y=[],v=[],w=0,b=0,S=0,k=!1,A=0;const E=(t,e)=>{let n=e(t);r.setQValue(t.state,t.a,n)},R=(t,e)=>{if(i.add(t),A++,A<10)return;A=0;let n=i.getBatch(100),l=[];n.forEach((t=>{let e=c.normalize(t.state,[0,0],[$-1,x-1]);l.push(e)})),c.predict(l).then((t=>{n.forEach(((n,r)=>{t[r][n.a]=e(n)})),c.fit(l,t).then((()=>{for(let t=0;t<x;t++)for(let e=0;e<$;e++){let n=[e,t],l=[c.normalize(n,[0,0],[$-1,x-1])];c.predict(l).then((t=>{for(let e=0;e<4;e++)r.setQValue(n,e,t[0][e])}))}}))}))},T=t=>{let e;return e=r.isTerminal(t.stateNext)?t.r:t.r+Vt*r.getMaxQValue(t.stateNext),k?e:.8*r.getQValue(t.state,t.a)+Tt*e},V=t=>{let e,n,a;r.isTerminal(t)?(y.push(S),v.push(w),l.updatePlot(),C()):o=setTimeout((()=>{n=r.getEpsilonGreedyAction(t,Qt),[e,a]=r.step(t,n),k?R({state:t,a:n,r:a,stateNext:e},T):E({state:t,a:n,r:a,stateNext:e},T),t=[...e],w+=a,S++,V(t)}),0)},z=t=>{let e;return e=r.isTerminal(t.stateNext)?t.r:t.r+Vt*r.getQValue(t.stateNext,t.aNext),k?e:.8*r.getQValue(t.state,t.a)+Tt*e},N=(t,e)=>{let n,a,s;r.isTerminal(t)?(y.push(S),v.push(w),l.updatePlot(),C()):o=setTimeout((()=>{[n,s]=r.step(t,e),a=r.getEpsilonGreedyAction(n,Qt),k?R({state:t,a:e,r:s,stateNext:n,aNext:a},z):E({state:t,a:e,r:s,stateNext:n,aNext:a},z),t=[...n],e=Number(a),w+=s,S++,N(t,e)}),0)},_=t=>{let e;if(r.isTerminal(t.stateNext))e=t.r;else{let n,l=0;n=.025;for(let e=0;e<4;e++)l+=n*r.getQValue(t.stateNext,e);n=.9;let a=r.getPolicy(t.stateNext);l+=n*r.getQValue(t.stateNext,a),e=t.r+Vt*l}return k?e:.8*r.getQValue(t.state,t.a)+Tt*e},B=(t,e)=>{let n,a,s;r.isTerminal(t)?(y.push(S),v.push(w),l.updatePlot(),C()):o=setTimeout((()=>{[n,s]=r.step(t,e),a=r.getEpsilonGreedyAction(n,Qt),k?R({state:t,a:e,r:s,stateNext:n,aNext:a},_):E({state:t,a:e,r:s,stateNext:n,aNext:a},_),t=[...n],e=Number(a),w+=s,S++,B(t,e)}),0)};let M=Array.from({length:$},(()=>Array.from({length:x},(()=>Array.from({length:4},(()=>null)))))),I=[];const P=()=>{let t=r.getRandomInt(I.length);return I[t]},Y=t=>{let e,n,a;r.isTerminal(t)?(y.push(S),v.push(w),l.updatePlot(),C()):o=setTimeout((()=>{n=r.getEpsilonGreedyAction(t,Qt),[e,a]=r.step(t,n),E({state:t,a:n,r:a,stateNext:e},T),((t,e,n,r)=>{let l=t[0],a=t[1],s=!1;for(let t=0;t<I.length;t++)if(I[t][0]==l&&I[t][1]==a&&I[t][2]==e){s=!0;break}s||I.push([t,e]),M[l][a][e]=[r,n]})(t,n,a,e),t=[...e];for(let t=0;t<h;t++){let t,e,n,r;[t,e]=P(),[r,n]=M[t[0]][t[1]][e],E({state:t,a:e,r:n,stateNext:r},T)}w+=a,S++,Y(t)}),0)};let L;const X=t=>{let e,n,a;r.isTerminal(t)?((()=>{for(let t=0;t<x;t++)for(let e=0;e<$;e++)for(let n=0;n<4;n++){let l=!1,a=0,s=1;for(let r=0;r<L.length;r++)e==L[r][0][0]&&t==L[r][0][1]&&n==L[r][1]&&(l=!0),l&&(a+=s*L[r][2],s*=Vt);if(l){let l=.8*r.getQValue([e,t],n)+Tt*a;r.setQValue([e,t],n,l)}}})(),y.push(S),v.push(w),l.updatePlot(),C()):o=setTimeout((()=>{n=r.getEpsilonGreedyAction(t,Qt),[e,a]=r.step(t,n),L.push([t,n,a]),t=[...e],w+=a,S++,X(t)}),0)},F=[{name:"Q-Learning",func:()=>{let t;w=0,S=0,t=m||r.getRandomStartState(),V(t)}},{name:"SARSA",func:()=>{let t,e;w=0,S=0,t=m||r.getRandomStartState(),e=r.getEpsilonGreedyAction(t,Qt),N(t,e)}},{name:"Expected-SARSA",func:()=>{let t,e;w=0,S=0,t=m||r.getRandomStartState(),e=r.getEpsilonGreedyAction(t,Qt),B(t,e)}},{name:"Dyna-Q",func:()=>{let t;w=0,S=0,t=m||r.getRandomStartState(),Y(t)}},{name:"Monte Carlo",func:()=>{let t;w=0,S=0,L=[],t=r.getRandomStartState(),X(t)}}],C=()=>{s=setTimeout((()=>{b<p&&(n(11,b++,b),F.forEach((t=>{a==t.name&&t.func()})))}),0)};return t.$$set=t=>{"blocked"in t&&n(0,u=t.blocked),"terminal"in t&&n(1,d=t.terminal),"rewards"in t&&n(2,f=t.rewards),"defaultReward"in t&&n(3,g=t.defaultReward),"startState"in t&&n(19,m=t.startState),"numEpisodes"in t&&n(20,p=t.numEpisodes),"planningSteps"in t&&n(21,h=t.planningSteps),"numX"in t&&n(4,$=t.numX),"numY"in t&&n(5,x=t.numY)},[u,d,f,g,$,x,r,l,y,v,a,b,i,c,k,F,C,()=>{s&&clearTimeout(s),o&&clearTimeout(o)},()=>{n(11,b=0),n(8,y=[]),n(9,v=[]),r.initQValues(),l.clearPlot(),c.resetModel(),i.clear()},m,p,h,function(t){Q[t?"unshift":"push"]((()=>{l=t,n(7,l)}))},function(t){v=t,n(9,v)},function(t){y=t,n(8,y)},function(){a=function(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}(this),n(10,a),n(15,F)},function(){k=this.checked,n(14,k)},function(t){Q[t?"unshift":"push"]((()=>{r=t,n(6,r)}))},function(t){Q[t?"unshift":"push"]((()=>{i=t,n(12,i)}))},function(t){Q[t?"unshift":"push"]((()=>{c=t,n(13,c)}))}]}class _t extends U{constructor(t){super(),K(this,t,Nt,Rt,o,{blocked:0,terminal:1,rewards:2,defaultReward:3,startState:19,numEpisodes:20,planningSteps:21,numX:4,numY:5},[-1,-1])}}const Bt=document.getElementById("maze-shell-0"),Mt=document.getElementById("maze-shell-1"),It=document.getElementById("maze-shell-2"),Pt=document.getElementById("maze-shell-3"),Yt=document.getElementById("maze-shell-4"),Lt=Bt?new _t({target:Bt,props:{numX:12,numY:3,planningSteps:10,blocked:Array(),terminal:Array([1,2],[2,2],[3,2],[4,2],[5,2],[6,2],[7,2],[8,2],[9,2],[10,2],[11,2]),rewards:Array([1,2,-10],[2,2,-10],[3,2,-10],[4,2,-10],[5,2,-10],[6,2,-10],[7,2,-10],[8,2,-10],[9,2,-10],[10,2,-10],[11,2,0]),defaultReward:-.1,startState:[0,2]}}):null,Xt=Mt?new _t({target:Mt,props:{numX:7,numY:3,planningSteps:10,blocked:Array(),terminal:Array([1,2],[2,2],[3,2],[4,2],[5,2],[6,2]),rewards:Array([1,2,-10],[2,2,-10],[3,2,-10],[4,2,-10],[5,2,-10],[6,2,0]),defaultReward:-.1,startState:[0,2]}}):null,Ft=It?new _t({target:It,props:{numX:5,numY:5,blocked:Array(),terminal:Array([1,1]),rewards:Array([1,1,1]),defaultReward:-.1}}):null,Ct=Pt?new _t({target:Pt,props:{numX:5,numY:5,blocked:Array(),terminal:Array([1,1]),rewards:Array([1,1,1],[3,3,1]),defaultReward:-.1}}):null,Gt=Yt?new _t({target:Yt,props:{numX:6,numY:4,blocked:Array([0,0],[3,2],[4,1],[3,3]),terminal:Array([1,1]),rewards:Array([1,1,1]),defaultReward:-.1}}):null;return t.comp0=Lt,t.comp1=Xt,t.comp2=Ft,t.comp3=Ct,t.comp4=Gt,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
//# sourceMappingURL=bundle.js.map
