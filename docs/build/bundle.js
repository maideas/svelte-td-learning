var app=function(t){"use strict";function e(){}function n(t,e){for(const n in e)t[n]=e[n];return t}function r(t){return t()}function l(){return Object.create(null)}function a(t){t.forEach(r)}function s(t){return"function"==typeof t}function o(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function i(t){const e={};for(const n in t)"$"!==n[0]&&(e[n]=t[n]);return e}function c(t){return null==t?"":t}function u(t,e){t.appendChild(e)}function d(t,e,n){t.insertBefore(e,n||null)}function f(t){t.parentNode.removeChild(t)}function g(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function p(t){return document.createElement(t)}function m(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function h(t){return document.createTextNode(t)}function $(){return h(" ")}function y(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function x(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function v(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function w(t,e,n,r){t.style.setProperty(e,n,r?"important":"")}function b(t,e){for(let n=0;n<t.options.length;n+=1){const r=t.options[n];if(r.__value===e)return void(r.selected=!0)}}function S(t,e,n){t.classList[n?"add":"remove"](e)}let A;function k(t){A=t}function E(t){(function(){if(!A)throw new Error("Function called outside component initialization");return A})().$$.on_mount.push(t)}const R=[],Q=[],V=[],T=[],z=Promise.resolve();let N=!1;function _(t){V.push(t)}function B(t){T.push(t)}let M=!1;const I=new Set;function P(){if(!M){M=!0;do{for(let t=0;t<R.length;t+=1){const e=R[t];k(e),Y(e.$$)}for(k(null),R.length=0;Q.length;)Q.pop()();for(let t=0;t<V.length;t+=1){const e=V[t];I.has(e)||(I.add(e),e())}V.length=0}while(R.length);for(;T.length;)T.pop()();N=!1,M=!1,I.clear()}}function Y(t){if(null!==t.fragment){t.update(),a(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(_)}}const L=new Set;let X;function F(){X={r:0,c:[],p:X}}function C(){X.r||a(X.c),X=X.p}function D(t,e){t&&t.i&&(L.delete(t),t.i(e))}function O(t,e,n,r){if(t&&t.o){if(L.has(t))return;L.add(t),X.c.push((()=>{L.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}}function G(t,e,n){const r=t.$$.props[e];void 0!==r&&(t.$$.bound[r]=n,n(t.$$.ctx[r]))}function j(t){t&&t.c()}function q(t,e,n){const{fragment:l,on_mount:o,on_destroy:i,after_update:c}=t.$$;l&&l.m(e,n),_((()=>{const e=o.map(r).filter(s);i?i.push(...e):a(e),t.$$.on_mount=[]})),c.forEach(_)}function H(t,e){const n=t.$$;null!==n.fragment&&(a(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function J(t,e){-1===t.$$.dirty[0]&&(R.push(t),N||(N=!0,z.then(P)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function K(t,n,r,s,o,i,c=[-1]){const u=A;k(t);const d=n.props||{},g=t.$$={fragment:null,ctx:null,props:i,update:e,not_equal:o,bound:l(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(u?u.$$.context:[]),callbacks:l(),dirty:c,skip_bound:!1};let p=!1;if(g.ctx=r?r(t,d,((e,n,...r)=>{const l=r.length?r[0]:n;return g.ctx&&o(g.ctx[e],g.ctx[e]=l)&&(!g.skip_bound&&g.bound[e]&&g.bound[e](l),p&&J(t,e)),n})):[],g.update(),p=!0,a(g.before_update),g.fragment=!!s&&s(g.ctx),n.target){if(n.hydrate){const t=function(t){return Array.from(t.childNodes)}(n.target);g.fragment&&g.fragment.l(t),t.forEach(f)}else g.fragment&&g.fragment.c();n.intro&&D(t.$$.fragment),q(t,n.target,n.anchor),P()}k(u)}class U{$destroy(){H(this,1),this.$destroy=e}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function W(t){let n,r,l;return{c(){n=m("svg"),r=m("path"),x(r,"fill","currentColor"),x(r,"d",t[0]),x(n,"aria-hidden","true"),x(n,"class",l=c(t[1])+" svelte-1d15yci"),x(n,"role","img"),x(n,"xmlns","http://www.w3.org/2000/svg"),x(n,"viewBox",t[2])},m(t,e){d(t,n,e),u(n,r)},p(t,[e]){1&e&&x(r,"d",t[0]),2&e&&l!==(l=c(t[1])+" svelte-1d15yci")&&x(n,"class",l),4&e&&x(n,"viewBox",t[2])},i:e,o:e,d(t){t&&f(n)}}}function Z(t,e,r){let{icon:l}=e,a=[],s="",o="";return t.$$set=t=>{r(4,e=n(n({},e),i(t))),"icon"in t&&r(3,l=t.icon)},t.$$.update=()=>{8&t.$$.dirty&&r(2,o="0 0 "+l.icon[0]+" "+l.icon[1]),r(1,s="fa-svelte "+(e.class?e.class:"")),8&t.$$.dirty&&r(0,a=l.icon[4])},e=i(e),[a,s,o,l]}class tt extends U{constructor(t){super(),K(this,t,Z,W,o,{icon:3})}}
/*!
     * Font Awesome Free 5.15.1 by @fontawesome - https://fontawesome.com
     * License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)
     */var et={prefix:"far",iconName:"arrow-alt-circle-up",icon:[512,512,[],"f35b","M256 504c137 0 248-111 248-248S393 8 256 8 8 119 8 256s111 248 248 248zm0-448c110.5 0 200 89.5 200 200s-89.5 200-200 200S56 366.5 56 256 145.5 56 256 56zm20 328h-40c-6.6 0-12-5.4-12-12V256h-67c-10.7 0-16-12.9-8.5-20.5l99-99c4.7-4.7 12.3-4.7 17 0l99 99c7.6 7.6 2.2 20.5-8.5 20.5h-67v116c0 6.6-5.4 12-12 12z"]};function nt(t){let e,n,r=t[2].toFixed()+"";return{c(){e=p("span"),n=h(r),x(e,"class","svelte-6n71zn")},m(t,r){d(t,e,r),u(e,n)},p(t,e){4&e&&r!==(r=t[2].toFixed()+"")&&v(n,r)},d(t){t&&f(e)}}}function rt(t){let e,n,r=t[2].toFixed(1)+"";return{c(){e=p("span"),n=h(r),x(e,"class","svelte-6n71zn")},m(t,r){d(t,e,r),u(e,n)},p(t,e){4&e&&r!==(r=t[2].toFixed(1)+"")&&v(n,r)},d(t){t&&f(e)}}}function lt(t){let e,n,r;return n=new tt({props:{icon:et}}),{c(){e=p("div"),j(n.$$.fragment),w(e,"font-size","32px"),w(e,"transform","rotate("+t[4]+"deg)"),x(e,"class","svelte-6n71zn")},m(t,l){d(t,e,l),q(n,e,null),r=!0},p(t,n){(!r||16&n)&&w(e,"transform","rotate("+t[4]+"deg)")},i(t){r||(D(n.$$.fragment,t),r=!0)},o(t){O(n.$$.fragment,t),r=!1},d(t){t&&f(e),H(n)}}}function at(t){let n;return{c(){n=h("terminal state")},m(t,e){d(t,n,e)},p:e,i:e,o:e,d(t){t&&f(n)}}}function st(t){let n;return{c(){n=h("blocked")},m(t,e){d(t,n,e)},p:e,i:e,o:e,d(t){t&&f(n)}}}function ot(t){let e,n,r,l,a,s,o,i,c,g,m,y,w,b,A,k,E,R,Q,V,T,z,N,_,B,M,I,P,Y,L,X=t[3][it.up].toFixed(3)+"",G=t[3][it.left].toFixed(3)+"",j=t[3][it.right].toFixed(3)+"",q=t[3][it.down].toFixed(3)+"";function H(t,e){return(null==c||4&e)&&(c=!!(Math.abs(t[2])<10)),c?rt:nt}let J=H(t,-1),K=J(t);const U=[st,at,lt],W=[];function Z(t,e){return t[0]?0:t[1]?1:2}return k=Z(t),E=W[k]=U[k](t),{c(){e=p("div"),n=p("div"),r=$(),l=p("div"),a=p("span"),s=h(X),o=$(),i=p("div"),K.c(),g=$(),m=p("div"),y=p("span"),w=h(G),b=$(),A=p("div"),E.c(),R=$(),Q=p("div"),V=p("span"),T=h(j),z=$(),N=p("div"),_=$(),B=p("div"),M=p("span"),I=h(q),P=$(),Y=p("div"),x(a,"class","svelte-6n71zn"),x(l,"class","sub-tile sub-tile-top svelte-6n71zn"),x(i,"class","sub-tile sub-tile-reward svelte-6n71zn"),S(i,"reward-is-negative",t[2]<0),x(y,"class","svelte-6n71zn"),x(m,"class","sub-tile sub-tile-left svelte-6n71zn"),x(A,"class","sub-tile sub-tile-middle svelte-6n71zn"),x(V,"class","svelte-6n71zn"),x(Q,"class","sub-tile sub-tile-right svelte-6n71zn"),x(M,"class","svelte-6n71zn"),x(B,"class","sub-tile sub-tile-bottom svelte-6n71zn"),x(e,"class","tile svelte-6n71zn"),x(e,"style",t[5]),S(e,"blocked",t[0]),S(e,"terminal",t[1])},m(t,c){d(t,e,c),u(e,n),u(e,r),u(e,l),u(l,a),u(a,s),u(e,o),u(e,i),K.m(i,null),u(e,g),u(e,m),u(m,y),u(y,w),u(e,b),u(e,A),W[k].m(A,null),u(e,R),u(e,Q),u(Q,V),u(V,T),u(e,z),u(e,N),u(e,_),u(e,B),u(B,M),u(M,I),u(e,P),u(e,Y),L=!0},p(t,[n]){(!L||8&n)&&X!==(X=t[3][it.up].toFixed(3)+"")&&v(s,X),J===(J=H(t,n))&&K?K.p(t,n):(K.d(1),K=J(t),K&&(K.c(),K.m(i,null))),4&n&&S(i,"reward-is-negative",t[2]<0),(!L||8&n)&&G!==(G=t[3][it.left].toFixed(3)+"")&&v(w,G);let r=k;k=Z(t),k===r?W[k].p(t,n):(F(),O(W[r],1,1,(()=>{W[r]=null})),C(),E=W[k],E?E.p(t,n):(E=W[k]=U[k](t),E.c()),D(E,1),E.m(A,null)),(!L||8&n)&&j!==(j=t[3][it.right].toFixed(3)+"")&&v(T,j),(!L||8&n)&&q!==(q=t[3][it.down].toFixed(3)+"")&&v(I,q),(!L||32&n)&&x(e,"style",t[5]),1&n&&S(e,"blocked",t[0]),2&n&&S(e,"terminal",t[1])},i(t){L||(D(E),L=!0)},o(t){O(E),L=!1},d(t){t&&f(e),K.d(),W[k].d()}}}const it=Object.freeze({up:0,right:1,down:2,left:3});function ct(t,e,n){let r,l,a,s,o=!1,i=!1,c=0,u="";const d=()=>{l=Math.max(...r),a=r.indexOf(l),n(4,s=(90*a).toFixed())},f=()=>{n(3,r=Array(4).fill().map((()=>Math.random()))),d()};return f(),[o,i,c,r,s,u,()=>o,()=>{n(0,o=!0)},()=>i,()=>{n(1,i=!0)},()=>c,t=>{n(2,c=t)},()=>a,t=>i?c:r[t],()=>i?c:l,(t,e)=>{n(3,r[t]=e,r),d()},f,t=>{let e,r,l,a=.35+.6*t;o||(e=0+255*a,r=110+145*a,l=210+45*a,n(5,u="background: rgb("+e+","+r+","+l+", 1);"))}]}class ut extends U{constructor(t){super(),K(this,t,ct,ot,o,{isBlocked:6,setBlocked:7,isTerminal:8,setTerminal:9,getReward:10,setReward:11,getPolicy:12,getQValue:13,getMaxQValue:14,setQValue:15,initQValues:16,setHeat:17})}get isBlocked(){return this.$$.ctx[6]}get setBlocked(){return this.$$.ctx[7]}get isTerminal(){return this.$$.ctx[8]}get setTerminal(){return this.$$.ctx[9]}get getReward(){return this.$$.ctx[10]}get setReward(){return this.$$.ctx[11]}get getPolicy(){return this.$$.ctx[12]}get getQValue(){return this.$$.ctx[13]}get getMaxQValue(){return this.$$.ctx[14]}get setQValue(){return this.$$.ctx[15]}get initQValues(){return this.$$.ctx[16]}get setHeat(){return this.$$.ctx[17]}}function dt(t,e,n){const r=t.slice();return r[22]=e[n],r[23]=e,r[24]=n,r}function ft(t,e,n){const r=t.slice();return r[22]=e[n],r[25]=e,r[26]=n,r}function gt(t){let e,n,r=t[26],l=t[24];const a=()=>t[19](e,r,l),s=()=>t[19](null,r,l);return e=new ut({props:{}}),a(),{c(){j(e.$$.fragment)},m(t,r){q(e,t,r),n=!0},p(t,n){r===t[26]&&l===t[24]||(s(),r=t[26],l=t[24],a());e.$set({})},i(t){n||(D(e.$$.fragment,t),n=!0)},o(t){O(e.$$.fragment,t),n=!1},d(t){s(),H(e,t)}}}function pt(t){let e,n,r=Array(t[0]),l=[];for(let e=0;e<r.length;e+=1)l[e]=gt(ft(t,r,e));const a=t=>O(l[t],1,1,(()=>{l[t]=null}));return{c(){for(let t=0;t<l.length;t+=1)l[t].c();e=h("")},m(t,r){for(let e=0;e<l.length;e+=1)l[e].m(t,r);d(t,e,r),n=!0},p(t,n){if(5&n){let s;for(r=Array(t[0]),s=0;s<r.length;s+=1){const a=ft(t,r,s);l[s]?(l[s].p(a,n),D(l[s],1)):(l[s]=gt(a),l[s].c(),D(l[s],1),l[s].m(e.parentNode,e))}for(F(),s=r.length;s<l.length;s+=1)a(s);C()}},i(t){if(!n){for(let t=0;t<r.length;t+=1)D(l[t]);n=!0}},o(t){l=l.filter(Boolean);for(let t=0;t<l.length;t+=1)O(l[t]);n=!1},d(t){g(l,t),t&&f(e)}}}function mt(t){let e,n,r=Array(t[1]),l=[];for(let e=0;e<r.length;e+=1)l[e]=pt(dt(t,r,e));const a=t=>O(l[t],1,1,(()=>{l[t]=null}));return{c(){e=p("div");for(let t=0;t<l.length;t+=1)l[t].c();x(e,"class","maze svelte-csffwp"),w(e,"grid-template-columns","repeat("+t[0]+", 100px)")},m(t,r){d(t,e,r);for(let t=0;t<l.length;t+=1)l[t].m(e,null);n=!0},p(t,[s]){if(7&s){let n;for(r=Array(t[1]),n=0;n<r.length;n+=1){const a=dt(t,r,n);l[n]?(l[n].p(a,s),D(l[n],1)):(l[n]=pt(a),l[n].c(),D(l[n],1),l[n].m(e,null))}for(F(),n=r.length;n<l.length;n+=1)a(n);C()}(!n||1&s)&&w(e,"grid-template-columns","repeat("+t[0]+", 100px)")},i(t){if(!n){for(let t=0;t<r.length;t+=1)D(l[t]);n=!0}},o(t){l=l.filter(Boolean);for(let t=0;t<l.length;t+=1)O(l[t]);n=!1},d(t){t&&f(e),g(l,t)}}}function ht(t,e,n){let{numX:r}=e,{numY:l}=e,{blocked:a=[]}=e,{terminal:s=[]}=e,{rewards:o=[]}=e,{defaultReward:i=0}=e,c=Array.from({length:r},(()=>Array.from({length:l},(()=>null))));E((()=>{a.forEach((t=>{c[t[0]][t[1]].setBlocked()})),s.forEach((t=>{c[t[0]][t[1]].setTerminal()}));for(let t=0;t<l;t++)for(let e=0;e<r;e++)c[e][t].setReward(i);o.forEach((t=>{c[t[0]][t[1]].setReward(t[2])})),g()}));const u=t=>Math.floor(Math.random()*Math.floor(t)),d=t=>c[t[0]][t[1]].isBlocked(),f=t=>c[t[0]][t[1]].isTerminal(),g=()=>{for(let t=0;t<l;t++)for(let e=0;e<r;e++)c[e][t].initQValues();$()},p=(t,e,n)=>{t[0]>=0&&t[0]<r&&t[1]>=0&&t[1]<l?(c[t[0]][t[1]].setQValue(e,n),$()):console.log("ERROR: Invalid setQValue coordinates [",t[0],":",t[1],"] !")},m=t=>c[t[0]][t[1]].getPolicy(),h=t=>t[0]>=0&&t[0]<r&&t[1]>=0&&t[1]<l?c[t[0]][t[1]].getReward():(console.log("ERROR: Invalid getReward coordinates [",t[0],":",t[1],"] !"),0),$=()=>{let t=1e6,e=-1e6;for(let n=0;n<l;n++)for(let l=0;l<r;l++){let r=c[l][n].getMaxQValue();t>r&&(t=r),e<r&&(e=r)}let n=e-t;for(let e=0;e<l;e++)for(let l=0;l<r;l++){let r=c[l][e].getMaxQValue();c[l][e].setHeat((r-t)/n)}};return t.$$set=t=>{"numX"in t&&n(0,r=t.numX),"numY"in t&&n(1,l=t.numY),"blocked"in t&&n(3,a=t.blocked),"terminal"in t&&n(4,s=t.terminal),"rewards"in t&&n(5,o=t.rewards),"defaultReward"in t&&n(6,i=t.defaultReward)},[r,l,c,a,s,o,i,u,d,f,g,p,(t,e)=>{for(let n=0;n<4;n++)p(t,n,e[n])},(t,e)=>c[t[0]][t[1]].getQValue(e),t=>c[t[0]][t[1]].getMaxQValue(),m,()=>{for(;;){let t=[u(r),u(l)];if(!f(t)&&!d(t))return t}},(t,e)=>Math.random()<e?u(4):m(t),(t,e)=>{let n=[...t];return e==it.down&&t[1]<l-1&&(n[1]+=1),e==it.right&&t[0]<r-1&&(n[0]+=1),e==it.up&&t[1]>0&&(n[1]-=1),e==it.left&&t[0]>0&&(n[0]-=1),d(n)&&(n=[...t]),[n,h(n)]},function(t,e,r){Q[t?"unshift":"push"]((()=>{c[e][r]=t,n(2,c)}))}]}class $t extends U{constructor(t){super(),K(this,t,ht,mt,o,{numX:0,numY:1,blocked:3,terminal:4,rewards:5,defaultReward:6,getRandomInt:7,isBlocked:8,isTerminal:9,initQValues:10,setQValue:11,setQValues:12,getQValue:13,getMaxQValue:14,getPolicy:15,getRandomStartState:16,getEpsilonGreedyAction:17,step:18})}get getRandomInt(){return this.$$.ctx[7]}get isBlocked(){return this.$$.ctx[8]}get isTerminal(){return this.$$.ctx[9]}get initQValues(){return this.$$.ctx[10]}get setQValue(){return this.$$.ctx[11]}get setQValues(){return this.$$.ctx[12]}get getQValue(){return this.$$.ctx[13]}get getMaxQValue(){return this.$$.ctx[14]}get getPolicy(){return this.$$.ctx[15]}get getRandomStartState(){return this.$$.ctx[16]}get getEpsilonGreedyAction(){return this.$$.ctx[17]}get step(){return this.$$.ctx[18]}}function yt(t){let n;return{c(){n=p("div"),x(n,"class","plot svelte-1qi4jkb")},m(e,r){d(e,n,r),t[12](n)},p:e,i:e,o:e,d(e){e&&f(n),t[12](null)}}}function xt(t,e,n){let r,{title:l=""}=e,{xIsLog:a=!1}=e,{data:s=[]}=e,{yIsLog:o=!1}=e,{yTitle:i=""}=e,{hasSecondY:c=!1}=e,{dataSecond:u=[]}=e,{ySecondIsLog:d=!1}=e,{ySecondTitle:f=""}=e;const g=()=>{let t=s.length?-.02*s.length:-.02,e=s.length?1.02*s.length:1.02,n={title:l,showlegend:!1,xaxis:{type:a?"log":"linear",range:[t,e]},yaxis:{title:i,type:o?"log":"linear",range:[-1.1,1.1],titlefont:{color:"#08C"},tickfont:{color:"#08C"},autorange:!0},margin:{autoexpand:!1,t:50,l:40,b:30,r:20}};""!=i&&(n.margin.l=60);let g=[{x:[...Array(s.length).keys()],y:s,mode:"lines",line:{shape:"spline"},type:"scatter"}];if(c){n.yaxis2={title:f,type:d?"log":"linear",range:[-1.1,1.1],overlaying:"y",side:"right",titlefont:{color:"#E60"},tickfont:{color:"#E60"},autorange:!0},n.margin.r=""!=f?60:40;let t={x:[...Array(u.length).keys()],y:u,mode:"lines",line:{shape:"spline"},type:"scatter",yaxis:"y2"};g.push(t)}Plotly.react(r,g,n,{displaylogo:!1})};return E((()=>{g()})),t.$$set=t=>{"title"in t&&n(3,l=t.title),"xIsLog"in t&&n(4,a=t.xIsLog),"data"in t&&n(1,s=t.data),"yIsLog"in t&&n(5,o=t.yIsLog),"yTitle"in t&&n(6,i=t.yTitle),"hasSecondY"in t&&n(7,c=t.hasSecondY),"dataSecond"in t&&n(2,u=t.dataSecond),"ySecondIsLog"in t&&n(8,d=t.ySecondIsLog),"ySecondTitle"in t&&n(9,f=t.ySecondTitle)},[r,s,u,l,a,o,i,c,d,f,g,()=>{n(1,s=[]),n(2,u=[]),g()},function(t){Q[t?"unshift":"push"]((()=>{r=t,n(0,r)}))}]}class vt extends U{constructor(t){super(),K(this,t,xt,yt,o,{title:3,xIsLog:4,data:1,yIsLog:5,yTitle:6,hasSecondY:7,dataSecond:2,ySecondIsLog:8,ySecondTitle:9,updatePlot:10,clearPlot:11})}get updatePlot(){return this.$$.ctx[10]}get clearPlot(){return this.$$.ctx[11]}}function wt(t,e,n){let r=[],{maxData:l=1e3}=e;return t.$$set=t=>{"maxData"in t&&n(0,l=t.maxData)},[l,t=>{for(;r.length>=l;)r.shift();r.push(t)},t=>{let e=r.length;if(e<=t)return[...r];let n=new Array(t),l=new Array(e);for(;t--;){let a=Math.floor(Math.random()*e);n[t]=r[a in l?l[a]:a],l[a]=--e in l?l[e]:e}return n},()=>[...r],()=>{r=[]}]}class bt extends U{constructor(t){super(),K(this,t,wt,null,o,{maxData:0,add:1,getBatch:2,getAll:3,clear:4})}get add(){return this.$$.ctx[1]}get getBatch(){return this.$$.ctx[2]}get getAll(){return this.$$.ctx[3]}get clear(){return this.$$.ctx[4]}}function St(t,e,n){class r extends tf.layers.Layer{constructor(){super({})}getClassName(){return"DuelingLayer"}computeOutputShape(t){return t[0]}call(t,e){return tf.tidy((()=>{const e=t[0],n=t[1];return e.sub(e.mean(1).reshape([-1,1])).add(n)}))}}let l;E((()=>{l=a()}));const a=()=>{const t=tf.input({shape:[2]}),e=tf.layers.dense({units:10,useBias:!0,activation:"tanh"}).apply(t),n=tf.layers.dense({units:10,useBias:!0,activation:"tanh"}).apply(e),l=tf.layers.dense({units:10,useBias:!0,activation:"tanh"}).apply(n),a=tf.layers.dense({units:4,useBias:!0,activation:"linear"}).apply(l),s=tf.layers.dense({units:10,useBias:!0,activation:"tanh"}).apply(n),o=tf.layers.dense({units:1,useBias:!0,activation:"linear"}).apply(s),i=(new r).apply([a,o]),c=tf.model({inputs:t,outputs:i});return c.compile({optimizer:tf.train.adam(.005),loss:"meanSquaredError",metrics:["accuracy"]}),c};return[()=>{l.resetStates()},async(t,e)=>{const n=tf.tensor2d(t,[t.length,t[0].length],"float32"),r=tf.tensor2d(e,[e.length,e[0].length],"float32");await l.fit(n,r,{batchSize:t.length,epochs:10,shuffle:!0,callbacks:{}}),n.dispose(),r.dispose()},t=>{let e;return tf.tidy((()=>{const n=tf.tensor2d(t,[t.length,t[0].length],"float32");e=l.predict(n).arraySync()})),e},(t,e,n)=>{let r=[];return t.forEach(((t,l)=>{t-=(n[l]+e[l])/2,t/=(n[l]-e[l])/2,r.push(t)})),r}]}class At extends U{constructor(t){super(),K(this,t,St,null,o,{resetModel:0,fit:1,predict:2,normalize:3})}get resetModel(){return this.$$.ctx[0]}get fit(){return this.$$.ctx[1]}get predict(){return this.$$.ctx[2]}get normalize(){return this.$$.ctx[3]}}function kt(t,e,n){const r=t.slice();return r[60]=e[n],r}function Et(t){let n,r,l,a=t[60].name+"";return{c(){n=p("option"),r=h(a),n.__value=l=t[60].name,n.value=n.__value},m(t,e){d(t,n,e),u(n,r)},p:e,d(t){t&&f(n)}}}function Rt(t){let e,n,r,l,s,o,i,c,m,S,A,k,E,R,V,T,z,N,M,I,P,Y,L,X,F,C,J,K,U,W,Z,tt,et,nt;function rt(e){t[25].call(null,e)}function lt(e){t[26].call(null,e)}let at={yTitle:"reward per episode",ySecondTitle:"steps per episode",hasSecondY:!1};void 0!==t[9]&&(at.data=t[9]),void 0!==t[8]&&(at.dataSecond=t[8]),r=new vt({props:at}),t[24](r),Q.push((()=>G(r,"data",rt))),Q.push((()=>G(r,"dataSecond",lt)));let st=t[17],ot=[];for(let e=0;e<st.length;e+=1)ot[e]=Et(kt(t,st,e));let it={numX:t[4],numY:t[5],blocked:t[0],terminal:t[1],rewards:t[2],defaultReward:t[3]};F=new $t({props:it}),t[29](F);let ct={maxData:t[16]};J=new bt({props:ct}),t[30](J),U=new bt({props:{maxData:zt}}),t[31](U);return Z=new At({props:{}}),t[32](Z),{c(){e=p("div"),n=p("div"),j(r.$$.fragment),o=$(),i=p("div"),c=h("EPISODE : "),m=h(t[11]),S=$(),A=p("div"),k=p("select");for(let t=0;t<ot.length;t+=1)ot[t].c();E=$(),R=p("div"),V=p("input"),T=h("\n      DQN"),z=$(),N=p("button"),N.textContent="init",M=$(),I=p("button"),I.textContent="halt",P=$(),Y=p("button"),Y.textContent="run",L=$(),X=p("div"),j(F.$$.fragment),C=$(),j(J.$$.fragment),K=$(),j(U.$$.fragment),W=$(),j(Z.$$.fragment),x(n,"class","narrow-box svelte-fcgxyy"),x(i,"class","box svelte-fcgxyy"),x(k,"class","svelte-fcgxyy"),void 0===t[10]&&_((()=>t[27].call(k))),x(V,"type","checkbox"),x(V,"class","svelte-fcgxyy"),x(R,"class","flex svelte-fcgxyy"),x(N,"class","svelte-fcgxyy"),x(I,"class","svelte-fcgxyy"),x(Y,"class","svelte-fcgxyy"),x(A,"class","box svelte-fcgxyy"),x(X,"class","narrow-box svelte-fcgxyy"),x(e,"class","container svelte-fcgxyy"),w(e,"width",16+100*t[4]+4*(t[4]-1)+"px")},m(l,a){d(l,e,a),u(e,n),q(r,n,null),u(e,o),u(e,i),u(i,c),u(i,m),u(e,S),u(e,A),u(A,k);for(let t=0;t<ot.length;t+=1)ot[t].m(k,null);b(k,t[10]),u(A,E),u(A,R),u(R,V),V.checked=t[15],u(R,T),u(A,z),u(A,N),u(A,M),u(A,I),u(A,P),u(A,Y),u(e,L),u(e,X),q(F,X,null),d(l,C,a),q(J,l,a),d(l,K,a),q(U,l,a),d(l,W,a),q(Z,l,a),tt=!0,et||(nt=[y(k,"change",t[27]),y(k,"change",t[20]),y(V,"change",t[28]),y(V,"change",t[20]),y(N,"click",t[20]),y(I,"click",t[19]),y(Y,"click",t[18])],et=!0)},p(t,n){const a={};if(!l&&512&n[0]&&(l=!0,a.data=t[9],B((()=>l=!1))),!s&&256&n[0]&&(s=!0,a.dataSecond=t[8],B((()=>s=!1))),r.$set(a),(!tt||2048&n[0])&&v(m,t[11]),131072&n[0]){let e;for(st=t[17],e=0;e<st.length;e+=1){const r=kt(t,st,e);ot[e]?ot[e].p(r,n):(ot[e]=Et(r),ot[e].c(),ot[e].m(k,null))}for(;e<ot.length;e+=1)ot[e].d(1);ot.length=st.length}132096&n[0]&&b(k,t[10]),32768&n[0]&&(V.checked=t[15]);const o={};16&n[0]&&(o.numX=t[4]),32&n[0]&&(o.numY=t[5]),1&n[0]&&(o.blocked=t[0]),2&n[0]&&(o.terminal=t[1]),4&n[0]&&(o.rewards=t[2]),8&n[0]&&(o.defaultReward=t[3]),F.$set(o),(!tt||16&n[0])&&w(e,"width",16+100*t[4]+4*(t[4]-1)+"px");J.$set({});U.$set({});Z.$set({})},i(t){tt||(D(r.$$.fragment,t),D(F.$$.fragment,t),D(J.$$.fragment,t),D(U.$$.fragment,t),D(Z.$$.fragment,t),tt=!0)},o(t){O(r.$$.fragment,t),O(F.$$.fragment,t),O(J.$$.fragment,t),O(U.$$.fragment,t),O(Z.$$.fragment,t),tt=!1},d(n){n&&f(e),t[24](null),H(r),g(ot,n),t[29](null),H(F),n&&f(C),t[30](null),H(J,n),n&&f(K),t[31](null),H(U,n),n&&f(W),t[32](null),H(Z,n),et=!1,a(nt)}}}const Qt=.1,Vt=.2,Tt=.9,zt=2e3;function Nt(t,e,n){let{blocked:r=[]}=e,{terminal:l=Array([0,0])}=e,{rewards:a=Array([0,0,1])}=e,{defaultReward:s=0}=e,{startState:o}=e,{numEpisodes:i=1e3}=e,{planningSteps:c=10}=e,{numX:u=5}=e,{numY:d=5}=e;const f=u*d;let g,p,m,h,$,y,x,v,w=[],b=[],S=0,A=0,k=0,R=!1,V=0;const T=t=>v.normalize(t,[0,0],[u-1,d-1]);E((()=>{for(let t=0;t<d;t++)for(let e=0;e<u;e++){let n=[e,t],r=T(n);y.add({state:n,normState:r})}}));const z=(t,e)=>{let n=e(t);g.setQValue(t.state,t.a,n)},N=(t,e)=>{if(t.normState=T(t.state),x.add(t),V++,V<10)return;V=0;const n=x.getBatch(100);let r=[];n.forEach((t=>{r.push(t.normState)}));let l=v.predict(r);n.forEach(((t,n)=>{l[n][t.a]=e(t)})),v.fit(r,l),y.getAll().forEach((t=>{let e=v.predict([t.normState]);g.setQValues(t.state,e[0])}))},_=t=>{let e;return e=g.isTerminal(t.stateNext)?t.r:t.r+Tt*g.getMaxQValue(t.stateNext),R?e:.8*g.getQValue(t.state,t.a)+Vt*e},B=t=>{let e,n,r;g.isTerminal(t)?(w.push(k),b.push(S),p.updatePlot(),j()):$=setTimeout((()=>{n=g.getEpsilonGreedyAction(t,Qt),[e,r]=g.step(t,n),R?N({state:t,a:n,r:r,stateNext:e},_):z({state:t,a:n,r:r,stateNext:e},_),t=[...e],S+=r,k++,B(t)}),0)},M=t=>{let e;return e=g.isTerminal(t.stateNext)?t.r:t.r+Tt*g.getQValue(t.stateNext,t.aNext),R?e:.8*g.getQValue(t.state,t.a)+Vt*e},I=(t,e)=>{let n,r,l;g.isTerminal(t)?(w.push(k),b.push(S),p.updatePlot(),j()):$=setTimeout((()=>{[n,l]=g.step(t,e),r=g.getEpsilonGreedyAction(n,Qt),R?N({state:t,a:e,r:l,stateNext:n,aNext:r},M):z({state:t,a:e,r:l,stateNext:n,aNext:r},M),t=[...n],e=Number(r),S+=l,k++,I(t,e)}),0)},P=t=>{let e;if(g.isTerminal(t.stateNext))e=t.r;else{let n,r=0;n=.025;for(let e=0;e<4;e++)r+=n*g.getQValue(t.stateNext,e);n=.9;let l=g.getPolicy(t.stateNext);r+=n*g.getQValue(t.stateNext,l),e=t.r+Tt*r}return R?e:.8*g.getQValue(t.state,t.a)+Vt*e},Y=(t,e)=>{let n,r,l;g.isTerminal(t)?(w.push(k),b.push(S),p.updatePlot(),j()):$=setTimeout((()=>{[n,l]=g.step(t,e),r=g.getEpsilonGreedyAction(n,Qt),R?N({state:t,a:e,r:l,stateNext:n,aNext:r},P):z({state:t,a:e,r:l,stateNext:n,aNext:r},P),t=[...n],e=Number(r),S+=l,k++,Y(t,e)}),0)};let L=Array.from({length:u},(()=>Array.from({length:d},(()=>Array.from({length:4},(()=>null)))))),X=[];const F=()=>{let t=g.getRandomInt(X.length);return X[t]},C=t=>{let e,n,r;g.isTerminal(t)?(w.push(k),b.push(S),p.updatePlot(),j()):$=setTimeout((()=>{n=g.getEpsilonGreedyAction(t,Qt),[e,r]=g.step(t,n),z({state:t,a:n,r:r,stateNext:e},_),((t,e,n,r)=>{let l=t[0],a=t[1],s=!1;for(let t=0;t<X.length;t++)if(X[t][0]==l&&X[t][1]==a&&X[t][2]==e){s=!0;break}s||X.push([t,e]),L[l][a][e]=[r,n]})(t,n,r,e),t=[...e];for(let t=0;t<c;t++){let t,e,n,r;[t,e]=F(),[r,n]=L[t[0]][t[1]][e],z({state:t,a:e,r:n,stateNext:r},_)}S+=r,k++,C(t)}),0)};let D;const O=t=>{let e,n,r;g.isTerminal(t)?((()=>{for(let t=0;t<d;t++)for(let e=0;e<u;e++)for(let n=0;n<4;n++){let r=!1,l=0,a=1;for(let s=0;s<D.length;s++)e==D[s][0][0]&&t==D[s][0][1]&&n==D[s][1]&&(r=!0),r&&(l+=a*D[s][2],a*=Tt);if(r){let r=.8*g.getQValue([e,t],n)+Vt*l;g.setQValue([e,t],n,r)}}})(),w.push(k),b.push(S),p.updatePlot(),j()):$=setTimeout((()=>{n=g.getEpsilonGreedyAction(t,Qt),[e,r]=g.step(t,n),D.push([t,n,r]),t=[...e],S+=r,k++,O(t)}),0)},G=[{name:"Q-Learning",func:()=>{let t;S=0,k=0,t=o||g.getRandomStartState(),B(t)}},{name:"SARSA",func:()=>{let t,e;S=0,k=0,t=o||g.getRandomStartState(),e=g.getEpsilonGreedyAction(t,Qt),I(t,e)}},{name:"Expected-SARSA",func:()=>{let t,e;S=0,k=0,t=o||g.getRandomStartState(),e=g.getEpsilonGreedyAction(t,Qt),Y(t,e)}},{name:"Dyna-Q",func:()=>{let t;S=0,k=0,t=o||g.getRandomStartState(),C(t)}},{name:"Monte Carlo",func:()=>{let t;S=0,k=0,D=[],t=g.getRandomStartState(),O(t)}}],j=()=>{h=setTimeout((()=>{A<i&&(n(11,A++,A),G.forEach((t=>{m==t.name&&t.func()})))}),0)};return t.$$set=t=>{"blocked"in t&&n(0,r=t.blocked),"terminal"in t&&n(1,l=t.terminal),"rewards"in t&&n(2,a=t.rewards),"defaultReward"in t&&n(3,s=t.defaultReward),"startState"in t&&n(21,o=t.startState),"numEpisodes"in t&&n(22,i=t.numEpisodes),"planningSteps"in t&&n(23,c=t.planningSteps),"numX"in t&&n(4,u=t.numX),"numY"in t&&n(5,d=t.numY)},[r,l,a,s,u,d,g,p,w,b,m,A,y,x,v,R,f,G,j,()=>{h&&clearTimeout(h),$&&clearTimeout($)},()=>{n(11,A=0),n(8,w=[]),n(9,b=[]),g.initQValues(),p.clearPlot(),v.resetModel(),x.clear()},o,i,c,function(t){Q[t?"unshift":"push"]((()=>{p=t,n(7,p)}))},function(t){b=t,n(9,b)},function(t){w=t,n(8,w)},function(){m=function(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}(this),n(10,m),n(17,G)},function(){R=this.checked,n(15,R)},function(t){Q[t?"unshift":"push"]((()=>{g=t,n(6,g)}))},function(t){Q[t?"unshift":"push"]((()=>{y=t,n(12,y)}))},function(t){Q[t?"unshift":"push"]((()=>{x=t,n(13,x)}))},function(t){Q[t?"unshift":"push"]((()=>{v=t,n(14,v)}))}]}class _t extends U{constructor(t){super(),K(this,t,Nt,Rt,o,{blocked:0,terminal:1,rewards:2,defaultReward:3,startState:21,numEpisodes:22,planningSteps:23,numX:4,numY:5},[-1,-1,-1])}}const Bt=document.getElementById("maze-shell-0"),Mt=document.getElementById("maze-shell-1"),It=document.getElementById("maze-shell-2"),Pt=document.getElementById("maze-shell-3"),Yt=document.getElementById("maze-shell-4"),Lt=Bt?new _t({target:Bt,props:{numX:12,numY:3,planningSteps:10,blocked:Array(),terminal:Array([1,2],[2,2],[3,2],[4,2],[5,2],[6,2],[7,2],[8,2],[9,2],[10,2],[11,2]),rewards:Array([1,2,-10],[2,2,-10],[3,2,-10],[4,2,-10],[5,2,-10],[6,2,-10],[7,2,-10],[8,2,-10],[9,2,-10],[10,2,-10],[11,2,0]),defaultReward:-.1,startState:[0,2]}}):null,Xt=Mt?new _t({target:Mt,props:{numX:7,numY:3,planningSteps:10,blocked:Array(),terminal:Array([1,2],[2,2],[3,2],[4,2],[5,2],[6,2]),rewards:Array([1,2,-10],[2,2,-10],[3,2,-10],[4,2,-10],[5,2,-10],[6,2,0]),defaultReward:-.1,startState:[0,2]}}):null,Ft=It?new _t({target:It,props:{numX:5,numY:5,blocked:Array(),terminal:Array([1,1]),rewards:Array([1,1,1]),defaultReward:-.1}}):null,Ct=Pt?new _t({target:Pt,props:{numX:5,numY:5,blocked:Array(),terminal:Array([1,1]),rewards:Array([1,1,1],[3,3,1]),defaultReward:-.1}}):null,Dt=Yt?new _t({target:Yt,props:{numX:6,numY:4,blocked:Array([0,0],[3,2],[4,1],[3,3]),terminal:Array([1,1]),rewards:Array([1,1,1]),defaultReward:-.1}}):null;return t.comp0=Lt,t.comp1=Xt,t.comp2=Ft,t.comp3=Ct,t.comp4=Dt,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
//# sourceMappingURL=bundle.js.map
